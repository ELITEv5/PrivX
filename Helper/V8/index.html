<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PrivX Shield Relay â€” Official Helper v8 â€œReward Protocol Editionâ€</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
  body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#eee;text-align:center;padding:2rem;max-width:900px;margin:auto}
  h1{color:#8b5cf6;font-size:2rem;margin-bottom:.3rem}
  h3{color:#00ffcc}
  a{color:#8b5cf6;text-decoration:none}
  a:hover{text-decoration:underline;color:#a36fff}
  button{background:#5c00ff;color:#fff;padding:.6rem 1rem;border:none;border-radius:8px;font-size:1rem;cursor:pointer;margin:.3rem;transition:.2s}
  button:hover{background:#6f14ff}
  button:disabled{background:#333;cursor:not-allowed}
  input{width:90%;max-width:420px;margin:.3rem 0;padding:.6rem;border-radius:8px;border:none;font-size:1rem;text-align:center;background:#161616;color:#00ffcc}
  .section{border:1px solid #222;border-radius:12px;padding:1.3rem;margin:1.5rem 0;background:#111}
  #status{margin-bottom:1rem;color:#f55;font-weight:bold}
  footer{margin-top:2rem;font-size:.9rem;color:#777}
  small{color:#aaa;display:block;margin-top:.5rem}
  .warning{color:#ffcc00}
  hr{border:none;border-top:1px solid #333;margin:1.5rem 0}
  .ca-box{background:#161616;padding:0.6rem;border-radius:8px;margin:0.3rem 0;word-break:break-all}
  .ca-copy{background:#333;color:#00ffcc;border:none;border-radius:6px;padding:0.3rem 0.7rem;cursor:pointer;font-size:0.85rem;margin-left:0.4rem;}
  .ca-copy:hover{background:#555;}
  .explainer{background:#141414;border-left:5px solid #8b5cf6;padding:1rem;border-radius:8px;text-align:left;line-height:1.5em;margin-bottom:1.5rem;}
  .hashList{background:#0f0f0f;border-radius:10px;padding:1rem;margin-top:1rem;text-align:left;max-height:220px;overflow-y:auto;}
  .hashItem{margin:0.5rem 0;padding:0.5rem;background:#161616;border-radius:8px;font-size:0.9rem;word-break:break-all;}
  .hashItem button{background:#ff006e;padding:0.3rem 0.8rem;font-size:0.8rem;border-radius:6px;margin-left:0.5rem;}
  .timer-glow{color:#ffcc00;text-shadow:0 0 10px #ffcc00,0 0 20px #ffaa00;animation:pulseGlow 2s infinite alternate;}
  @keyframes pulseGlow{from{text-shadow:0 0 10px #ffcc00,0 0 20px #ffaa00;}to{text-shadow:0 0 20px #ffaa00,0 0 40px #ff8800;}}
  .feed{background:#0d0d0d;border:1px solid #222;border-radius:10px;padding:1rem;margin-top:1rem;text-align:left;max-height:180px;overflow-y:auto;}
  .feed-entry{font-size:0.9rem;margin:0.4rem 0;}
  .feed-entry span{font-weight:bold;}
  .glow{color:#8b5cf6;text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff;}
</style>
</head>

<body>
<h1>ğŸ›¡ï¸ PrivX Shield Relay Helper â€” v8 â€œReward Protocol Editionâ€</h1>
<p><b>Built by Elite Team6 â€¢ Â© Elite Labs â€¢ 2025</b></p>

<!-- ğŸŒ WHY PRIVX SECTION -->
<div class="explainer" id="why-privx">
  <h3 style="color:#00ffcc;">ğŸŒ Why PrivX Exists â€” Privacy That Accelerates With Participation</h3>
  <p><b>PrivX isnâ€™t about hiding â€” itâ€™s about blending in faster.</b></p>
  <p>Modern blockchains are transparent by design. Every wallet, every transfer, every pattern is visible forever.  
     <b>PrivX</b> transforms this transparency into a collective privacy shield, powered by mathematics â€” not secrecy.</p>
  <hr>
  <h4 style="color:#00ffcc;">ğŸ§  The Core Mechanism</h4>
  <p>Each deposit in the Shield Relay is locked under a <code>keccak256(secret)</code> hash.  
     The <b>secret</b> remains private, while the <b>hash</b> becomes your on-chain proof.  
     When you or a recipient reveal the secret to withdraw, it matches the stored hash and releases the tokens.</p>
  <p>As hundreds or thousands of users do this â€” at different times and with different amounts â€”  
     it becomes statistically impossible to know which deposit maps to which withdrawal.</p>
  <hr>
  <h4 style="color:#00ffcc;">ğŸ§® The Mathematics of Participation</h4>
  <p>The PrivX privacy field is defined by three simple variables:</p>
  <pre style="background:#0d0d0d;padding:0.8rem;border-radius:8px;color:#00ffcc;">
T âˆ 1 / (A Ã— W)
  </pre>
  <ul style="text-align:left;line-height:1.5em;">
    <li><b>A</b> = active deposits (crowd size)</li>
    <li><b>W</b> = average number of withdrawal wallets</li>
    <li><b>T</b> = time needed for unlinkability</li>
  </ul>
  <p>The more users join, and the more wallets are used per secret, the faster privacy becomes statistically untraceable.</p>
  <blockquote style="border-left:3px solid #8b5cf6;padding-left:1rem;margin:1rem 0;color:#ccc;">
    â€œIn PrivX, privacy accelerates with adoption â€” the more people, the faster the shield.â€
  </blockquote>
  <h4 style="color:#00ffcc;">ğŸ•“ Time and Entropy</h4>
  <p>Each deposit lasts 7 days before expiry. Within that window, withdrawals are indistinguishable.  
     When deposits expire, 95% burns permanently and 5% rewards reclaimers â€” ensuring the vault is always in motion.</p>
  <h4 style="color:#00ffcc;">âš™ï¸ Transparent Privacy</h4>
  <p>All actions are public and auditable â€” yet linkages vanish within the crowd.  
     PrivX achieves privacy without encryption, without custodians, and without compromise.</p>
  <h4 style="color:#00ffcc;">ğŸ“ˆ The Network Effect</h4>
  <p>As more people use PrivX, each user strengthens the privacy of every other.  
    Participation fuels anonymity â€” time and crowd density multiply the protection field.  
    What begins as a single userâ€™s transaction becomes part of a collective, self-sustaining privacy web.</p>
  <p style="margin-top:1rem;color:#8b5cf6;font-weight:bold;">
    PrivX turns transparency into trustless privacy â€” powered entirely by participation.
  </p>
</div>

<!-- ğŸ“œ Official CAs -->
<div class="section" style="background:#141414;">
  <h3>ğŸ“œ Official Contract Addresses</h3>
  <div class="ca-box">
    ğŸ’  PRIVX Token:<br>
    <code id="caToken">0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986</code>
    <button class="ca-copy" onclick="copyCA('caToken')">Copy</button><br>
    <a href="https://scan.pulsechain.com/address/0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986" target="_blank">View on PulseChainScan â†—</a>
  </div>
  <div class="ca-box">
    ğŸ›¡ï¸ Shield Relay V8:<br>
    <code id="caRelay">0x9ef6144a2f544A28e030e69a79c5B527c8B48f2e</code>
    <button class="ca-copy" onclick="copyCA('caRelay')">Copy</button><br>
    <a href="https://scan.pulsechain.com/address/0x9ef6144a2f544A28e030e69a79c5B527c8B48f2e" target="_blank">View on PulseChainScan â†—</a>
  </div>
  <small>âœ… Verified Immutable Contracts â€” No Admin â€¢ No Upgrades â€¢ 100 % On-Chain.</small>
</div>

<!-- ğŸ’ REWARD PROTOCOL -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’ The Reward Protocol â€” Earning While Strengthening Privacy</h3>
  <p>PrivX v8 introduces a <b>reward system</b> that turns participation into passive yield.  
     Every expired deposit contributes 5% to the reward mechanism â€” distributed to reclaimers and participants who help sustain the privacy field.</p>
  <ul style="text-align:left;line-height:1.5em;">
    <li>ğŸŸ£ <b>5% of expired deposits</b> go to reclaimers automatically.</li>
    <li>ğŸ’  The <b>Reward Metric</b> shows total PRIVX earned network-wide via reclaims.</li>
    <li>âš¡ Rewards are distributed through <code>Reclaimed</code> events â€” visible live below.</li>
    <li>ğŸ“ˆ The more you interact, the more privacy & reward you generate.</li>
  </ul>
  <p style="color:#8b5cf6;font-weight:bold;margin-top:.8rem;">
    â€œIn PrivX v8, privacy pays back â€” participation becomes power.â€
  </p>
</div>

<!-- ğŸ’  TOKENOMICS -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’  PrivX Tokenomics</h3>
  <p>The <b>PRIVX</b> token powers the entire Shield ecosystem â€” fixed at <b>21 million PRIVX</b> total supply with no minting, no owner, and deflationary burn built in.</p>
  <p>Each use of the Shield Relay burns 0.3% on withdrawal and up to 95% on expiry â€” with 5% redistributed to reclaimers as rewards.</p>
  <small>âš™ï¸ Deflationary â€¢ Autonomous â€¢ Utility by Design.</small>
</div>

<!-- ğŸ”¥ Burn Counter -->
<div class="section" style="background:#121212;">
  <h3>ğŸ”¥ Total PRIVX Burned</h3>
  <h2 id="burnCounter" class="glow">Loading...</h2>
  <small id="burnUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>

<!-- ğŸ”’ Vault Tracker -->
<div class="section" style="background:#121212;">
  <h3>ğŸ”’ Shield Vault Tracker</h3>
  <p>Total PRIVX held by the Shield Relay (User Deposits):</p>
  <h2 id="vaultBalance" style="color:#00ff99;font-weight:bold;">Loading...</h2>
  <small id="vaultUpdate">â³ Waiting for dataâ€¦</small>
</div>
  
  <!-- ğŸ’ Reward Pool Tracker -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’ Active Reward Pool</h3>
  <p>Total PRIVX currently available for rewards (airdrop + fees):</p>
  <h2 id="rewardPool" style="color:#8b5cf6;font-weight:bold;">Loading...</h2>
  <small id="rewardUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>


<!-- ğŸ“Š NETWORK PARTICIPATION (live metric) -->
<div class="section" style="background:#121212;">
  <h3>ğŸ“Š Network Participation</h3>
  <p>
    Tracks total PRIVX in motion â€” deposits, burns, and reclaims â€” 
    the pulse of the Shield. Updated every 20 seconds.
  </p>
  <h2 id="networkActivity" class="glow-pulse">Loading...</h2>
  <small id="networkUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>

<style>
  /* ğŸŒŒ soft pulse animation for the main number */
  .glow-pulse {
    color:#8b5cf6;
    text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff,0 0 30px #3c00aa;
    animation:pulseMetric 2s infinite alternate;
  }
  @keyframes pulseMetric {
    from { text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff; }
    to   { text-shadow:0 0 25px #9d72ff,0 0 45px #8b5cf6; }
  }
</style>


<p>Status: <span id="status">Disconnected</span></p>
<button id="connect">ğŸ”— Connect Wallet</button>
<button id="disconnect" style="display:none;background:#333;">ğŸ”Œ Disconnect</button>


<!-- DEPOSIT -->
<div class="section">
  <h3>ğŸ’° Step 1 â€” Deposit PRIVX</h3>
  <p>1ï¸âƒ£ Generate your <b>Secret & Hash</b> using the <a href="https://elitev5.github.io/PrivX/Hash-Generator/" target="_blank">official Hash Generator â†—</a>.</p>
  <p>2ï¸âƒ£ Copy your <b>Hash</b> and paste it below.</p>
  <p>3ï¸âƒ£ Enter how much PRIVX you want to deposit (e.g. 10).</p>
  <input id="depositAmount" placeholder="Amount (e.g. 10)" /><br/>
  <input id="depositHash" placeholder="Secret Hash (0xâ€¦)" /><br/>
  <button id="approveBtn">âœ… Approve PRIVX</button>
  <button id="depositBtn">ğŸš€ Deposit</button>
  <small>âš™ï¸ Approve once, then deposit anytime with new hashes.</small>
</div>

<!-- WITHDRAW -->
<div class="section">
  <h3>ğŸ’ Step 2 â€” Withdraw Funds</h3>
  <p>Use your <b>Secret</b> to withdraw to up to 3 wallet addresses within 7 days.</p>
  <input id="withdrawSecret" placeholder="Secret (UTF-8 string)" /><br/>
  <input id="wallet1" placeholder="Wallet 1 (0xâ€¦)" /><br/>
  <input id="wallet2" placeholder="Wallet 2 (optional)" /><br/>
  <input id="wallet3" placeholder="Wallet 3 (optional)" /><br/>
  <button id="withdrawBtn">ğŸ’ Withdraw</button>
  <small class="warning">âš ï¸ Anyone with your Secret can withdraw within 7 days â€” keep it safe.</small>
</div>

<!-- RECLAIM -->
<div class="section">
  <h3>ğŸ”¥ Step 3 â€” Reclaim Expired Deposits</h3>
  <p>After 7 days, anyone can reclaim unclaimed deposits using their hash.</p>
  <input id="reclaimHash" placeholder="Deposit Hash (0xâ€¦)" /><br/>
  <button id="reclaimBtn">ğŸ”¥ Reclaim</button>
  <small>ğŸ’ Reclaim rewards 5% to the caller â€¢ 95% burnt forever ğŸ”¥</small>
</div>

<!-- CLAIM HELPER -->
<div class="section" style="background:#161616;">
  <h3>ğŸ§© Claim Helper â€” Find Unclaimed Deposits</h3>
  <p>View all expired deposits ready to reclaim. Copy or reclaim directly below.</p>
  <button id="loadReclaimable">ğŸ” Load Reclaimable Hashes</button>
  <div id="reclaimList" class="hashList">Press to viewâ€¦</div>
  <small>Auto-refreshes every 30 seconds â€¢ View-only â€¢ No wallet needed.</small>
</div>

<!-- DEPOSIT CHECKER -->
<div class="section" style="background:#101010;">
  <h3>ğŸ” Check Your Deposit Status</h3>
  <p>Enter your <b>Deposit Hash</b> to see amount, date, and status (plus countdown timer).</p>
  <input id="checkHash" placeholder="Deposit Hash (0xâ€¦)" /><br/>
  <button id="checkBtn">ğŸ” Check Status</button>
  <div id="checkResult" style="margin-top:1rem;color:#00ff99;font-family:monospace;"></div>
  <small>Works even without wallet connection.</small>
</div>

<!-- ğŸ“˜ How It Works & Best Practices -->
<div class="section" style="background:#131313;">
  <h3>ğŸ“˜ How It Works â€” Step by Step</h3>
  <ol style="text-align:left;line-height:1.6em;">
    <li><b>Generate Secret & Hash</b> â€” Use the <a href="https://elitev5.github.io/PrivX/Hash-Generator/" target="_blank">Hash Generator</a> to create a unique pair.</li>
    <li><b>Deposit PRIVX</b> â€” Enter hash and amount, approve once, then deposit.</li>
    <li><b>Withdraw</b> â€” Within 7 days use your Secret to withdraw to up to 3 wallets (0.3 % burn).</li>
    <li><b>Reclaim</b> â€” After 7 days anyone can reclaim (95 % burn / 5 % reward).</li>
    <li><b>Check</b> â€” Verify any deposit on-chain by its hash.</li>
  </ol>

  <h3>ğŸ§­ Best Practices</h3>
  <ul style="text-align:left;line-height:1.6em;">
    <li>ğŸª™ <b>Backup your Secret.</b> Lose it = lose access.</li>
    <li>ğŸ” <b>Keep your Secret private.</b> Anyone with it can withdraw within 7 days.</li>
    <li>ğŸ•“ <b>Respect the 7-day window.</b> Withdraw on time or funds become claimable.</li>
    <li>ğŸ”¥ <b>Expired deposits are burned.</b> 95% destroyed â€¢ 5% rewarded â€¢ no middlemen.</li>
    <li>âš™ï¸ <b>Verify contract addresses.</b> Only use official PRIVX and Shield Relay CAs.</li>
    <li>ğŸ§© <b>More users = more privacy.</b> Each deposit adds noise and protection.</li>
  </ul>

  <p style="color:#8b5cf6;font-weight:bold;margin-top:1rem;">â€œThe more we walk together, the harder we are to follow.â€</p>
  <p style="color:#00ffcc;">PrivX â€” Privacy by participation. Strength in numbers.</p>
</div>

<footer>
  <hr>
  <p>PulseChain Native â€¢ MIT License â€¢ Open Source</p>
  <p><a href="https://github.com/elitev5/PrivX" target="_blank" rel="noopener noreferrer">View Source on GitHub</a></p>
  <p style="margin-top:1rem;color:#8b5cf6;font-weight:bold;">â€œWe donâ€™t hide. We outnumber.â€</p>
</footer>

<!-- ==== MAIN LOGIC ==== -->
<script>
async function copyCA(id){
  const t = document.getElementById(id).textContent.trim();
  await navigator.clipboard.writeText(t);
  alert("âœ… Copied:\n" + t);
}

(async()=>{
  const relayAddress = "0x9ef6144a2f544A28e030e69a79c5B527c8B48f2e";
  const tokenAddress = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
  const PULSECHAIN_ID = "0x171";
  let provider, signer, contract, account, privx;
  const abi = await fetch("./abi.json").then(r=>r.json());
  const pubProv = new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
  const pubContract = new ethers.Contract(relayAddress, abi, pubProv);
  // disable wallet-only buttons until connected
["approveBtn","depositBtn","withdrawBtn","reclaimBtn"].forEach(id=>{
  document.getElementById(id).disabled = true;
});

  async function updateVaultBalance(){
    try{
      const b = await pubContract.totalVaultBalance();
      document.getElementById("vaultBalance").textContent = ethers.utils.formatUnits(b,18) + " PRIVX";
      document.getElementById("vaultUpdate").textContent = "âœ… Updated " + new Date().toLocaleTimeString();
    } catch(e){
      document.getElementById("vaultBalance").textContent = "Error";
    }
  }

  async function updateBurnCounter(){
    try{
      const burned = await pubContract.totalBurned();
      document.getElementById("burnCounter").textContent = ethers.utils.formatUnits(burned,18) + " PRIVX ğŸ”¥";
      document.getElementById("burnUpdate").textContent = "âœ… Synced " + new Date().toLocaleTimeString();
    } catch(e){
      document.getElementById("burnCounter").textContent = "Error";
    }
  }
  
// ------------------- REWARD POOL UPDATE -------------------
async function updateRewardPool() {
  try {
    let poolValue;
    try {
      // Primary getter (new V8)
      poolValue = await pubContract.getRewardPool();
    } catch {
      // Fallback for compatibility
      poolValue = await pubContract.rewardPool();
    }

    const formatted = ethers.utils.formatUnits(poolValue, 18);
    document.getElementById("rewardPool").textContent = `${formatted} PRIVX ğŸŸ£`;
    document.getElementById("rewardUpdate").textContent = `âœ… Synced ${new Date().toLocaleTimeString()}`;
  } catch (e) {
    document.getElementById("rewardPool").textContent = "Error";
    document.getElementById("rewardUpdate").textContent = `âš ï¸ ${e.message}`;
  }
}

// ------------------- NETWORK ACTIVITY METRIC -------------------
async function updateNetworkActivity() {
  try {
    const [vault, burned, reclaimed, withdrawals] = await Promise.all([
      pubContract.totalVaultBalance(),
      pubContract.totalBurned(),
      pubContract.totalReclaimed(),
      pubContract.totalWithdrawals()
    ]);

    const f = x => parseFloat(ethers.utils.formatUnits(x, 18));
    const totalMove = f(vault) + f(burned) + f(reclaimed);
    const summary =
      `Vault ${f(vault).toFixed(2)} | Burn ${f(burned).toFixed(2)} | ` +
      `Reclaim ${f(reclaimed).toFixed(2)} | Tx ${withdrawals.toString()}`;

    document.getElementById("networkActivity").textContent =
      `${totalMove.toFixed(2)} PRIVX Total Movement`;
    document.getElementById("networkUpdate").textContent =
      `âœ… ${summary} â€¢ ${new Date().toLocaleTimeString()}`;
  } catch (e) {
    document.getElementById("networkActivity").textContent = "Error";
    document.getElementById("networkUpdate").textContent = `âš ï¸ ${e.message}`;
  }
}

// auto-refresh
setInterval(updateRewardPool, 15000);
setInterval(updateNetworkActivity, 20000);


  async function ensurePulse(){
    const c = await window.ethereum.request({method:"eth_chainId"});
    if(c !== PULSECHAIN_ID){
      alert("âš ï¸ Please switch to PulseChain.");
      return false;
    }
    return true;
  }

  async function connect(){
    if(!window.ethereum) return alert("No wallet found.");
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    if(!await ensurePulse()) return;
    signer = provider.getSigner();
    account = await signer.getAddress();
    document.getElementById("status").textContent = "âœ… Connected: " + account.slice(0,6) + "â€¦"+ account.slice(-4);
    document.getElementById("status").style.textShadow = "0 0 6px #0f0";
    document.getElementById("disconnect").style.display = "inline-block";
    ["approveBtn","depositBtn","withdrawBtn","reclaimBtn"].forEach(id=>{
  document.getElementById(id).disabled = false;
});
    contract = new ethers.Contract(relayAddress, abi, signer);
    privx = new ethers.Contract(tokenAddress, ["function approve(address,uint256) external returns(bool)"], signer);

    // Auto-refresh reward pool when Reclaim events fire
contract.on("Reclaimed", () => {
  updateRewardPool();
});


    updateVaultBalance();
    updateBurnCounter();
    updateRewardPool();
  }

  function disconnect(){
    provider = signer = contract = privx = account = null;
    document.getElementById("status").textContent = "Disconnected";
    document.getElementById("status").style.color = "#f55";
    document.getElementById("disconnect").style.display = "none";
    alert("Wallet disconnected.");
  }

  async function approve(){
    try{
      const tx = await privx.approve(relayAddress, ethers.constants.MaxUint256);
      alert("âœ… Approval sent:\n"+tx.hash);
    } catch(e){
      alert("Approval failed:\n"+e.message);
    }
  }

  async function deposit(){
    const amt = document.getElementById("depositAmount").value.trim();
    const h = document.getElementById("depositHash").value.trim();
    if(!amt || !h) return alert("Enter amount and hash.");
    if(!await ensurePulse()) return;
    try{
      const v = ethers.utils.parseUnits(amt,18);
      let gasLimit;
      try{ gasLimit = await contract.estimateGas.deposit(v, h); }
      catch{ gasLimit = 300000; }
      const tx = await contract.deposit(v, h, {gasLimit});
      alert("â³ Deposit sent:\n"+tx.hash);
      updateVaultBalance();
      updateRewardPool();
    } catch(e){
      alert("Deposit failed:\n"+e.message);
    }
  }

  async function withdraw(){
    const s = document.getElementById("withdrawSecret").value.trim();
    const addrs = ["wallet1","wallet2","wallet3"].map(id => document.getElementById(id).value.trim()).filter(a=>a && ethers.utils.isAddress(a));
    if(!s || addrs.length===0) return alert("Enter your Secret and at least one wallet address.");
    if(!await ensurePulse()) return;
    try{
      const tx = await contract.withdraw(s, addrs);
      alert("âœ… Withdraw submitted!\nTx: "+tx.hash);
      updateVaultBalance();
      updateRewardPool();
    } catch(e){
      alert("Withdraw failed:\n"+e.message);
    }
  }

  async function reclaim(){
    const h = document.getElementById("reclaimHash").value.trim();
    if(!h) return alert("Enter deposit hash.");
    if(!await ensurePulse()) return;
    try{
      const tx = await contract.reclaim(h);
      alert("ğŸ”¥ Reclaim submitted!\nTx: "+tx.hash);
      updateVaultBalance();
      updateBurnCounter();
      updateRewardPool();
    } catch(e){
      alert("Reclaim failed:\n"+e.message);
    }
  }

  async function loadReclaimable(){
    const list = document.getElementById("reclaimList");
    list.innerHTML = "â³ Loadingâ€¦";
    try{
      const hashes = await pubContract.getReclaimableDeposits();
      if(!hashes.length){
        list.innerHTML = "âœ… No reclaimable deposits now.";
      } else {
        list.innerHTML = "";
        hashes.forEach(h=>{
          const d = document.createElement("div");
          d.className = "hashItem";
          d.innerHTML = `<code>${h}</code> <button onclick="navigator.clipboard.writeText('${h}')">Copy</button>`;
          list.appendChild(d);
        });
      }
    } catch(e){
      list.innerHTML = "âŒ Error: " + e.message;
    }
  }

  document.getElementById("loadReclaimable").onclick = loadReclaimable;
  setInterval(loadReclaimable,30000);

  document.getElementById("connect").onclick = connect;
  document.getElementById("disconnect").onclick = disconnect;
  document.getElementById("approveBtn").onclick = approve;
  document.getElementById("depositBtn").onclick = deposit;
  document.getElementById("withdrawBtn").onclick = withdraw;
  document.getElementById("reclaimBtn").onclick = reclaim;
  document.getElementById("checkBtn").onclick = async ()=>{
    const hash = document.getElementById("checkHash").value.trim();
    const res = document.getElementById("checkResult");
    if(!hash) return alert("Enter a deposit hash.");
    res.style.color = "#aaa";
    res.innerHTML = "â³ Checkingâ€¦";
    try{
      const d = await pubContract.getDeposit(hash);
      if(d.amount.isZero()||d.timestamp.isZero()){
        res.style.color = "#f55";
        return res.innerHTML = "âŒ No deposit found.";
      }
      const amt = ethers.utils.formatUnits(d.amount,18);
      const dep = d.timestamp*1000;
      const exp = dep + 7*24*60*60*1000;
      const now = Date.now();
      const remaining = exp - now;
      if(d.claimed || remaining <= 0){
        res.style.color = d.claimed ? "#0f0" : "#ffcc00";
        const finalStatus = d.claimed ? "âœ… Claimed":"ğŸ”¥ Claimable Now (7 days passed)";
        res.innerHTML = `Amount: ${amt} PRIVX<br>Deposited: ${new Date(dep).toLocaleString()}<br>Status: ${finalStatus}`;
        return;
      }
      const dys = Math.floor(remaining/(1000*60*60*24));
      const hrs = Math.floor((remaining/(1000*60*60))%24);
      const mins = Math.floor((remaining/(1000*60))%60);
      const secs = Math.floor((remaining/1000)%60);
      res.style.color = "#00ff99";
      res.innerHTML = `Amount: ${amt} PRIVX<br>Deposited: ${new Date(dep).toLocaleString()}<br>Status: â³ Unclaimed<br><span class="timer-glow">ğŸ•“ Time until claimable: ${dys}d ${hrs}h ${mins}m ${secs}s</span>`;
      } catch(e){
    res.style.color = "#f55";
    res.textContent = "âŒ Error: "+e.message;
  }
};

// âœ… --- PUBLIC DATA AUTO-UPDATER (works without wallet) ---
updateVaultBalance();
updateBurnCounter();
updateRewardPool();
updateNetworkActivity();
loadReclaimable();

// Periodic refresh timers for public data
setInterval(updateVaultBalance, 20000);
setInterval(updateBurnCounter, 25000);
setInterval(updateRewardPool, 20000);
setInterval(updateNetworkActivity, 25000);
setInterval(loadReclaimable, 60000);

})();
</script>
</body>
</html>


