<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PLSX Proof of Privacy Shield V2.2 — Elite Team6</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
  body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#eee;text-align:center;padding:2rem;max-width:900px;margin:auto}
  h1{color:#8b5cf6;font-size:2.2rem;margin:0;display:flex;align-items:center;justify-content:center;gap:1rem}
  h1 img{width:64px;filter:drop-shadow(0 0 15px #8b5cf6);animation:glow 4s infinite alternate}
  @keyframes glow{from{filter:drop-shadow(0 0 10px #8b5cf6);}to{filter:drop-shadow(0 0 30px #5c00ff);}}
  h3{color:#00ffcc;margin-top:1.5rem}
  button{background:#5c00ff;color:#fff;padding:.7rem 1.3rem;border:none;border-radius:8px;font-size:1rem;cursor:pointer;margin:.4rem;transition:.2s;box-shadow:0 4px 15px rgba(91,0,255,.3)}
  button:hover{background:#7000ff;transform:translateY(-2px);box-shadow:0 8px 25px rgba(91,0,255,.5)}
  button:disabled{background:#333;cursor:not-allowed;transform:none;box-shadow:none}
  input{width:90%;max-width:460px;margin:.5rem auto;padding:.8rem;border-radius:8px;border:none;background:#161616;color:#00ffcc;text-align:center;font-size:1.1rem}
  .section{background:#111;border:1px solid #222;border-radius:12px;padding:1.6rem;margin:2rem 0;box-shadow:0 4px 20px rgba(0,0,0,.5)}
  .warning{color:#ff3300;font-weight:bold;background:#330c0c;padding:1rem;border-radius:8px;margin:1rem 0}
  .success{color:#00ff99}
  .ca-box{background:#161616;padding:1rem;border-radius:8px;margin:1rem 0;word-break:break-all;font-family:monospace}
  .ca-copy{background:#333;color:#00ffcc;padding:0.3rem 0.7rem;border-radius:6px;cursor:pointer}
  .explainer{background:#141414;border-left:6px solid #8b5cf6;padding:1.5rem;border-radius:10px;text-align:left;line-height:1.7}
  .glow{color:#8b5cf6;text-shadow:0 0 20px #8b5cf6}
  .feed{max-height:200px;overflow-y:auto;background:#0c0c0c;padding:1rem;border-radius:8px;text-align:left;font-size:0.9rem}
  .feed-entry{margin:0.4rem 0;color:#aaa}
  .feed-entry span{color:#00ffcc;font-weight:bold}
  footer{margin-top:3rem;color:#777;font-size:0.9rem}
  hr{border:none;border-top:1px dashed #333;margin:2rem 0}
</style>
</head>
<body>

<h1>
  <img src="PRIV.png" alt="PLSX Shield">
  PLSX Proof of Privacy Shield <span style="font-size:1rem;color:#00ffcc">V2.2</span>
</h1>
<p style="font-size:1.2rem;color:#00ffcc;">True Stealth • Zero Reward Link • Maximum PRIVX Burn</p>
<p>Built by <b>Elite Team6</b> • 2025</p>

<div class="warning">
  NEW CONTRACT: 0x588a1e316B9EB91ec784CB8A329a3Fcc02d65B0C<br>
  Old shield is deprecated. Use this UI + the <b>ABI-ENCODE GENERATOR ONLY</b>
</div>

<!-- WALLET -->
<div class="section">
  <button id="connect">Connect Wallet</button>
  <button id="disconnect" style="display:none;background:#ff006e">Disconnect</button>
  <div id="status" style="margin-top:1rem;font-weight:bold;color:#aaa">Not connected</div>
</div>

<!-- OFFICIAL ADDRESSES -->
<div class="section">
  <h3>Official Contracts</h3>
  <div class="ca-box">PLSX: 0x95B303987A60C71504D99Aa1b13B4DA07b0790ab <button class="ca-copy" onclick="copy('0x95B303987A60C71504D99Aa1b13B4DA07b0790ab')">Copy</button></div>
  <div class="ca-box">PRIVX: 0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986 <button class="ca-copy" onclick="copy('0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986')">Copy</button></div>
  <div class="ca-box success">Shield V2.2: 0x588a1e316B9EB91ec784CB8A329a3Fcc02d65B0C <button class="ca-copy" onclick="copy('0x588a1e316B9EB91ec784CB8A329a3Fcc02d65B0C')">Copy</button></div>
</div>

<!-- EXPLAINER -->
<div class="explainer">
  <h3>Why V2.2 Is Elite Privacy</h3>
  <ul>
    <li>Deposit fee in PRIVX → 80% burned, 20% to reward pool</li>
    <li><b>Withdraw fee in PLSX → no PRIVX touch = zero linkability</b></li>
    <li>Secret-based random split (1–3 wallets)</li>
    <li>Reclaim after 7 days: 95% value burned as PRIVX, 5% PLSX to reclaimer</li>
    <li>Commit-reveal prevents front-running</li>
    <li>Fully immutable, no owner</li>
  </ul>
</div>

<!-- STATS -->
<div class="section">
  <h3>Shield Stats</h3>
  <div>Vault: <b id="vault">Loading...</b> PLSX</div>
  <div>Reward Pool: <b id="pool">Loading...</b> PRIVX</div>
  <div>Total PRIVX Burned: <b id="burned">Loading...</b></div>
  <div>Withdrawals: <b id="withdrawals">Loading...</b> • Reclaims: <b id="reclaims">Loading...</b></div>
</div>

<!-- STEP 1: DEPOSIT -->
<div class="section">
  <h3>Step 1 — Deposit PLSX</h3>
  <p>Use the <a href="https://elitev5.github.io/PrivX/Hash-Generator/PLSX" target="_blank"><b>OFFICIAL ABI GENERATOR</b></a></p>
  <input id="depAmt" placeholder="Amount (e.g. 1000)" />
  <div style="color:#ffcc00;margin:1rem">PRIVX Fee: <b id="fee">Calculating...</b></div>
  <input id="depHash" placeholder="Deposit Hash (0x...)" />
  <br><br>
  <button id="approvePrivx">Approve PRIVX</button>
  <button id="approvePlsx">Approve PLSX</button>
  <button id="deposit">Deposit</button>
</div>

<!-- STEP 2: COMMIT -->
<div class="section" style="background:#161616">
  <h3>Step 2 — Commit (Anti-MEV)</h3>
  <input id="commitHash" placeholder="Commit Hash from generator" />
  <button id="commit">Commit</button>
  <small>Wait 1–2 blocks after commit before withdraw</small>
</div>

<!-- STEP 3: WITHDRAW -->
<div class="section">
  <h3>Step 3 — Withdraw (Pure Stealth)</h3>
  <input id="secret" placeholder="Paste FULL secret (64-char hex)" style="font-family:monospace;letter-spacing:1px;" />
  <br><br>
  <input id="w1" placeholder="Receive Wallet 1" />
  <input id="w2" placeholder="Receive Wallet 2 (optional)" />
  <input id="w3" placeholder="Receive Wallet 3 (optional)" />
  <br><br>
  <button id="withdraw">Withdraw PLSX</button>
  <div class="warning">0.3% PLSX fee taken at withdraw • Use fresh wallets</div>
</div>

<!-- RECLAIM -->
<div class="section">
  <h3>Reclaim Expired (95% PRIVX Burn)</h3>
  <input id="reclaimHash" placeholder="Deposit Hash" />
  <button id="reclaim">Reclaim</button>
</div>

<!-- CHECK DEPOSIT -->
<div class="section">
  <h3>Check Deposit</h3>
  <input id="checkHash" placeholder="Deposit Hash" />
  <button id="check">Check Status</button>
  <div id="result" style="margin-top:1rem;"></div>
</div>

<footer>
  <hr>
  <p>Elite Team6 • PulseChain • 2025</p>
  <p><a href="https://github.com/ELITEv5/PrivX" target="_blank">GitHub</a> • “We outnumber.”</p>
</footer>

<script>
// CONFIG
const SHIELD = "0x588a1e316B9EB91ec784CB8A329a3Fcc02d65B0C";
const PLSX = "0x95B303987A60C71504D99Aa1b13B4DA07b0790ab";
const PRIVX = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
const PRIVX_ORACLE = "0x08Ba2656f26Be2636C3cC6DCF21F97473ad49A20";
const PLSX_ORACLE = "0xF806d677E27f01FCa750ab4C50E6b5ADaDCEb271";

let provider, signer, shield, plsx, privx, account;

// ABI (only what we need)
const ABI = [
  "function deposit(uint256 amount, bytes32 secretHash)",
  "function commit(bytes32 commitHash)",
  "function withdraw(string secret, address[] recipients)",
  "function reclaim(bytes32 hash)",
  "function deposits(bytes32) view returns (uint256 amount, uint256 timestamp, bool claimed)",
  "function totalVaultBalance() view returns (uint256)",
  "function rewardPool() view returns (uint256)",
  "function totalBurned() view returns (uint256)",
  "function totalWithdrawals() view returns (uint256)",
  "function totalReclaimed() view returns (uint256)",
  "function getSystemStats() view returns (uint256,uint256,uint256,uint256,uint256)"
];

const ERC20 = ["function approve(address,uint256) returns (bool)", "function allowance(address,address) view returns (uint256)"];

async function connect() {
  if (!window.ethereum) return alert("Install MetaMask/Rabby");
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  account = await signer.getAddress();
  const net = await provider.getNetwork();
  if (net.chainId !== 369) return alert("Switch to PulseChain");
  
  shield = new ethers.Contract(SHIELD, ABI, signer);
  plsx = new ethers.Contract(PLSX, ERC20, signer);
  privx = new ethers.Contract(PRIVX, ERC20, signer);
  
  document.getElementById("status").innerHTML = `Connected: <b>${account.slice(0,8)}...${account.slice(-6)}</b>`;
  document.getElementById("status").style.color = "#00ff99";
  document.getElementById("disconnect").style.display = "inline-block";
  updateStats();
}

document.getElementById("disconnect").onclick = () => location.reload();

async function approve(token, name) {
  const allowance = await token.allowance(account, SHIELD);
  if (allowance.gt(ethers.constants.MaxUint256.div(2))) {
    alert(`${name} already approved`);
    return;
  }
  const tx = await token.approve(SHIELD, ethers.constants.MaxUint256);
  await tx.wait();
  alert(`${name} approved!`);
}

async function calcFee() {
  const amt = document.getElementById("depAmt").value;
  if (!amt) return;
  const pub = new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
  const pOracle = new ethers.Contract(PLSX_ORACLE, ["function peekSpotPrice() view returns (uint256)"], pub);
  const vOracle = new ethers.Contract(PRIVX_ORACLE, ["function peekSpotPrice() view returns (uint256)"], pub);
  const [pPrice, vPrice] = await Promise.all([pOracle.peekSpotPrice(), vOracle.peekSpotPrice()]);
  const fee = ethers.utils.parseUnits(amt,18).mul(pPrice).mul(30).div(10000).div(vPrice);
  document.getElementById("fee").textContent = ethers.utils.formatUnits(fee,18).slice(0,12) + " PRIVX";
}

document.getElementById("depAmt").oninput = calcFee;

document.getElementById("approvePrivx").onclick = () => approve(privx, "PRIVX");
document.getElementById("approvePlsx").onclick = () => approve(plsx, "PLSX");

document.getElementById("deposit").onclick = async () => {
  const amt = ethers.utils.parseUnits(document.getElementById("depAmt").value || "0", 18);
  const hash = document.getElementById("depHash").value.trim();
  if (amt.isZero() || !hash) return alert("Fill amount + hash");
  const tx = await shield.deposit(amt, hash);
  await tx.wait();
  alert("Deposited! Tx: " + tx.hash);
  updateStats();
};

document.getElementById("commit").onclick = async () => {
  const h = document.getElementById("commitHash").value.trim();
  if (!h) return alert("Paste commit hash");
  const tx = await shield.commit(h);
  await tx.wait();
  alert("Committed! Tx: " + tx.hash);
};

document.getElementById("withdraw").onclick = async () => {
  const secret = document.getElementById("secret").value;
  const wallets = [1,2,3].map(i => document.getElementById("w"+i).value.trim()).filter(w => w && ethers.utils.isAddress(w));
  if (!secret) return alert("Paste secret");
  if (wallets.length === 0) return alert("Add at least one wallet");
  const tx = await shield.withdraw(secret, wallets);
  await tx.wait();
  alert("WITHDRAWN! Pure stealth activated.\nTx: " + tx.hash);
  updateStats();
};

document.getElementById("reclaim").onclick = async () => {
  const h = document.getElementById("reclaimHash").value.trim();
  if (!h) return alert("Paste hash");
  const tx = await shield.reclaim(h);
  await tx.wait();
  alert("Reclaimed & burned! Tx: " + tx.hash);
  updateStats();
};

document.getElementById("check").onclick = async () => {
  const h = document.getElementById("checkHash").value.trim();
  if (!h) return;
  const pub = new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
  const c = new ethers.Contract(SHIELD, ABI, pub);
  const d = await c.deposits(h);
  const amt = ethers.utils.formatUnits(d.amount,18);
  const time = new Date(d.timestamp.toNumber()*1000);
  const daysLeft = Math.max(0, (time.getTime() + 7*86400000 - Date.now()) / 86400000).toFixed(2);
  document.getElementById("result").innerHTML = `
    <b>${d.claimed ? "CLAIMED" : daysLeft > 0 ? daysLeft+" days left" : "EXPIRED"}</b><br>
    Amount: ${amt} PLSX<br>Deposited: ${time.toLocaleDateString()}
  `;
};

async function updateStats() {
  const pub = new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
  const c = new ethers.Contract(SHIELD, ABI, pub);
  const stats = await c.getSystemStats();
  document.getElementById("vault").textContent = ethers.utils.formatUnits(stats[0],18);
  document.getElementById("pool").textContent = ethers.utils.formatUnits(stats[1],18);
  document.getElementById("burned").textContent = ethers.utils.formatUnits(stats[2],18);
  document.getElementById("withdrawals").textContent = stats[3].toString();
  document.getElementById("reclaims").textContent = stats[4].toString();
}

function copy(text) {
  navigator.clipboard.writeText(text);
  alert("Copied!");
}

document.getElementById("connect").onclick = connect;
setInterval(updateStats, 30000);
updateStats();
</script>
</body>
</html>
