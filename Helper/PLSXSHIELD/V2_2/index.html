<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLSX Shield v2.2 ‚Äî Proof of Privacy by PRIVX</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
  body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#eee;text-align:center;padding:2rem;max-width:900px;margin:auto}
  h1{color:#8b5cf6;font-size:2rem;margin-bottom:.3rem;display:flex;align-items:center;justify-content:center;gap:.5rem}
  h3{color:#00ffcc}
  a{color:#8b5cf6;text-decoration:none}
  a:hover{text-decoration:underline;color:#a36fff}
  button{background:#5c00ff;color:#fff;padding:.6rem 1rem;border:none;border-radius:8px;font-size:1rem;cursor:pointer;margin:.3rem;transition:.2s}
  button:hover{background:#6f14ff}
  input{width:90%;max-width:420px;margin:.3rem 0;padding:.6rem;border-radius:8px;border:none;font-size:1rem;text-align:center;background:#161616;color:#00ffcc}
  .section{border:1px solid #222;border-radius:12px;padding:1.3rem;margin:1.5rem 0;background:#111}
</style>
</head>
<body>
<h1>üõ°Ô∏è PLSX Proof of Privacy Shield ‚Äî v2.2</h1>
<p style="color:#00ffcc">PLSX privacy layer powered by PRIVX deflation ‚Ä¢ Built by Elite Team6</p>

<!-- WHY PRIVX SECTION -->
<div class="section" style="background:#141414;">
  <h3>üåê Why PRIVX Matters</h3>
  <p><b>Every PLSX Shield deposit pays a small fee in PRIVX, creating ongoing burn pressure on PRIVX and feeding the reward pool.</b></p>
  <p>PRIVX provides the stealth gas layer ‚Äî you pay deposit fees in PRIVX, not PLSX. 80% burns forever, 20% goes to random rewards.</p>
  <p>The more the shield is used, the scarcer PRIVX becomes ‚Äî driving organic deflation.</p>
</div>

<!-- WALLET CONNECT -->
<div class="section">
  <h3>üîó Connect Wallet</h3>
  <button id="connect">Connect</button>
  <button id="disconnect" style="display:none;">Disconnect</button>
  <div id="status">Not connected</div>
</div>

<!-- DEPOSIT -->
<div class="section">
  <h3>üí∞ Step 1 ‚Äî Deposit PLSX</h3>
  <p>1Ô∏è‚É£ Generate Secret + Deposit Hash via <a href="https://elitev5.github.io/PrivX/Hash-Generator/PLSX" target="_blank">Official Hash Generator</a>.</p>
  <p>2Ô∏è‚É£ Enter your deposit hash and amount. Fee: 0.3% in PRIVX (oracle-priced).</p>
  <input id="depositAmount" placeholder="PLSX Amount" />
  <div id="feeDisplay" style="color:#ffcc00">Required PRIVX Fee: ...</div>
  <input id="depositHash" placeholder="Deposit Hash (0x...)" />
  <button id="approvePrivxBtn">Approve PRIVX</button>
  <button id="approvePlsxBtn">Approve PLSX</button>
  <button id="depositBtn">Deposit</button>
</div>

<!-- COMMIT -->
<div class="section">
  <h3>üï∂Ô∏è Step 2 ‚Äî Commit Secret</h3>
  <p>Pre-commit your secret hash to prevent front-running. Window ~13 mins.</p>
  <input id="commitHashInput" placeholder="Commit Hash (from generator)" />
  <button id="commitBtn">Commit</button>
</div>

<!-- WITHDRAW -->
<div class="section">
  <h3>üöÄ Step 3 ‚Äî Withdraw PLSX</h3>
  <p>Paste your full secret and destination wallet(s) (up to 3).</p>
  <input id="withdrawSecret" placeholder="Secret" />
  <input id="wallet1" placeholder="Wallet 1 (0x...)" />
  <input id="wallet2" placeholder="Wallet 2 (optional)" />
  <input id="wallet3" placeholder="Wallet 3 (optional)" />
  <button id="withdrawBtn">Withdraw</button>
  <small style="color:#ffcc00">Use a fresh wallet each time for max privacy.</small>
</div>

<!-- RECLAIM -->
<div class="section">
  <h3>üî• Step 4 ‚Äî Reclaim Expired</h3>
  <p>After 7 days, reclaim unclaimed deposits. 95% burns, 5% PLSX to caller.</p>
  <input id="reclaimHash" placeholder="Deposit Hash (0x...)" />
  <button id="reclaimBtn">Reclaim</button>
</div>

<!-- SYSTEM STATS -->
<div class="section">
  <h3>üìä Live System Stats</h3>
  <p>Vault (PLSX): <span id="vaultBalance">...</span></p>
  <p>Reward Pool (PRIVX): <span id="rewardPool">...</span></p>
  <p>Total PRIVX Burned: <span id="burnedPrivx">...</span></p>
  <p>Withdrawals: <span id="withdrawals">...</span></p>
  <p>Reclaimed (PLSX): <span id="reclaimed">...</span></p>
  <hr>
  <p>PLSX Price (in WPLS): <span id="plsxPrice">...</span></p>
  <p>PRIVX Price (in WPLS): <span id="privxPrice">...</span></p>
</div>

<!-- BEST PRACTICES -->
<div class="section" style="background:#131313;">
  <h3>üß≠ Best Practices</h3>
  <ul style="text-align:left;line-height:1.6em;">
    <li>ü™ô Always back up your Secret ‚Äî it unlocks your funds.</li>
    <li>üîê Never share your Secret ‚Äî it grants access to your PLSX.</li>
    <li>üï∂Ô∏è Always Commit before Withdraw to prevent MEV.</li>
    <li>üïì Withdraw within 7 days, or your deposit becomes reclaimable.</li>
    <li>üî• Expired deposits burn 95% PLSX, rewarding network integrity.</li>
    <li>üí† Reuse of wallets reduces privacy ‚Äî rotate wallets often.</li>
  </ul>
  <p style="color:#8b5cf6">Privacy is a choice ‚Äî participation strengthens the shield.</p>
</div>

<footer style="margin-top:2rem;color:#777;font-size:.9rem;">
  <hr style="border:none;border-top:1px solid #333;margin:1.5rem 0;">
  <p>PulseChain Native ‚Ä¢ Built by Elite Team6 ‚Ä¢ MIT Licensed</p>
  <p><a href="https://github.com/ELITEv5/PrivX" target="_blank">GitHub Repo</a></p>
</footer>

<script>
const relayAddress = "0x588a1e316B9EB91ec784CB8A329a3Fcc02d65B0C";
const plsxAddress = "0x95B303987A60C71504D99Aa1b13B4DA07b0790ab";
const privxAddress = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
const privxOracleAddress = "0x08Ba2656f26Be2636C3cC6DCF21F97473ad49A20";
const plsxOracleAddress = "0xF806d677E27f01FCa750ab4C50E6b5ADaDCEb271";
let provider, signer, contract, plsx, privx, privxOracle, plsxOracle;
let abi, privxOracleAbi, plsxOracleAbi;

async function connect() {
  if (!window.ethereum) return alert('Install MetaMask or Rabby.');
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send('eth_requestAccounts', []);
  signer = provider.getSigner();
  account = await signer.getAddress();
  document.getElementById('status').textContent = `‚úÖ Connected: ${account.slice(0,6)}...${account.slice(-4)}`;
  document.getElementById('disconnect').style.display = 'inline';

  abi = await fetch('./abi.json').then(r=>r.json());
  privxOracleAbi = await fetch('./PrivXOracleabi.json').then(r=>r.json());
  plsxOracleAbi = await fetch('./PLSXoracleabi.json').then(r=>r.json());

  contract = new ethers.Contract(relayAddress, abi, signer);
  privxOracle = new ethers.Contract(privxOracleAddress, privxOracleAbi, provider);
  plsxOracle = new ethers.Contract(plsxOracleAddress, plsxOracleAbi, provider);

  plsx = new ethers.Contract(plsxAddress,["function approve(address,uint256)","function allowance(address,address) view returns (uint256)"],signer);
  privx = new ethers.Contract(privxAddress,["function approve(address,uint256)","function allowance(address,address) view returns (uint256)"],signer);

  updateStats();
  setInterval(updateStats,30000);
}

function disconnect(){location.reload();}

document.getElementById('connect').onclick=connect;
document.getElementById('disconnect').onclick=disconnect;

document.getElementById('approvePrivxBtn').onclick=async()=>{const tx=await privx.approve(relayAddress,ethers.constants.MaxUint256);await tx.wait();alert('PRIVX Approved');};
document.getElementById('approvePlsxBtn').onclick=async()=>{const tx=await plsx.approve(relayAddress,ethers.constants.MaxUint256);await tx.wait();alert('PLSX Approved');};

document.getElementById('depositBtn').onclick=async()=>{const a=document.getElementById('depositAmount').value.trim();const h=document.getElementById('depositHash').value.trim();if(!a||!h)return alert('Enter amount & hash');const tx=await contract.deposit(ethers.utils.parseUnits(a,18),h);await tx.wait();alert('Deposit Confirmed');updateStats();};

document.getElementById('commitBtn').onclick=async()=>{const h=document.getElementById('commitHashInput').value.trim();const tx=await contract.commit(h);await tx.wait();alert('Commit Confirmed');};

document.getElementById('withdrawBtn').onclick=async()=>{const s=document.getElementById('withdrawSecret').value.trim();const w=["wallet1","wallet2","wallet3"].map(id=>document.getElementById(id).value.trim()).filter(x=>x);if(!s||!w.length)return alert('Enter secret & at least one wallet');const tx=await contract.withdraw(s,w);await tx.wait();alert('Withdraw Successful');updateStats();};

document.getElementById('reclaimBtn').onclick=async()=>{const h=document.getElementById('reclaimHash').value.trim();const tx=await contract.reclaim(h);await tx.wait();alert('Reclaimed');updateStats();};

async function updateStats(){
  try{
    const stats=await contract.getSystemStats();
    document.getElementById('vaultBalance').textContent=ethers.utils.formatUnits(stats[0],18)+' PLSX';
    document.getElementById('rewardPool').textContent=ethers.utils.formatUnits(stats[1],18)+' PRIVX';
    document.getElementById('burnedPrivx').textContent=ethers.utils.formatUnits(stats[2],18)+' PRIVX';
    document.getElementById('withdrawals').textContent=stats[3].toString();
    document.getElementById('reclaimed').textContent=ethers.utils.formatUnits(stats[4],18)+' PLSX';

    const plsxP=await plsxOracle.peekSpotPrice();
    const privxP=await privxOracle.peekSpotPrice();
    document.getElementById('plsxPrice').textContent=ethers.utils.formatUnits(plsxP,18)+' WPLS';
    document.getElementById('privxPrice').textContent=ethers.utils.formatUnits(privxP,18)+' WPLS';

    const amount=document.getElementById('depositAmount').value;
    if(amount){const f=await computePrivxFee(amount,plsxP,privxP);document.getElementById('feeDisplay').textContent=`Required PRIVX Fee: ${f} PRIVX`;}
  }catch(e){console.error(e);}
}

async function computePrivxFee(a,plsxPerPls,privxPerPls){const x=ethers.utils.parseUnits(a,18);const bp=30;const d=10000;const f=x.mul(plsxPerPls).mul(bp).div(d).div(privxPerPls);return ethers.utils.formatUnits(f,18);}

document.getElementById('depositAmount').addEventListener('input',updateStats);
</script>
</body>
</html>

