<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PLSX Stealth Shield ‚Äî Proof of Privacy v3.1</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=IBM+Plex+Mono&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
:root {
  --bg: #0d0f11;
  --fg: #e5e7eb;
  --accent: #6b5cff;
  --accent2: #00c4b4;
  --muted: #9ca3af;
  --border: #1f2428;
  --card: #131518;
  --radius: 16px;
  --mono: "IBM Plex Mono", monospace;
  --sans: "Inter", system-ui, sans-serif;
}
* { box-sizing: border-box; }
body {
  background: var(--bg);
  color: var(--fg);
  font-family: var(--sans);
  margin: 0;
  line-height: 1.6;
}
h1,h2,h3,h4 { font-weight:600; margin:0 0 .4em; }
a { color: var(--accent2); text-decoration:none; }
a:hover { text-decoration:underline; }
main { max-width: 920px; margin: auto; padding: 2rem 1rem 6rem; }

/* Header */
header {
  text-align: center;
  padding-top: 2rem;
}
header h1 {
  font-size: 2.1rem;
  background: linear-gradient(90deg,var(--accent),var(--accent2));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: .2rem;
}
header p {
  color: var(--muted);
  font-size: 1rem;
}

/* Buttons & Inputs */
button {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: .6rem 1.1rem;
  font-size: .95rem;
  cursor: pointer;
  transition: .2s ease;
}
button:hover { opacity: .85; }
button:disabled { background:#333; color:#777; cursor:not-allowed; }

input {
  width: 100%;
  max-width: 420px;
  padding: .6rem .7rem;
  margin:.4rem 0;
  border-radius: 10px;
  border:1px solid var(--border);
  background: var(--card);
  color: var(--accent2);
  font-family: var(--mono);
  text-align:center;
}

/* Sections / Cards */
.section {
  background: var(--card);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:1.4rem 1.6rem;
  margin:1.6rem 0;
  box-shadow: 0 0 0 rgba(0,0,0,0);
  transition: box-shadow .2s;
}
.section:hover {
  box-shadow: 0 0 18px rgba(107,92,255,0.05);
}

/* Collapsible stats */
#statsPanel {
  overflow:hidden;
  transition: max-height .5s ease;
  max-height:0;
}
#statsPanel.open { max-height:600px; }
.stats-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:.6rem .8rem;
  margin-top:.8rem;
}
.stats-grid div {
  background:#181a1d;
  border-radius:10px;
  padding:.6rem .8rem;
  text-align:left;
  font-family:var(--mono);
  font-size:.9rem;
}

/* Explainers */
.explainer {
  background:#111315;
  border-left:4px solid var(--accent);
  border-radius:10px;
  padding:1rem 1.2rem;
  margin:1.6rem 0;
}

/* Footer */
footer {
  text-align:center;
  margin-top:3rem;
  color:var(--muted);
  font-size:.9rem;
}
footer hr {
  border:none;
  border-top:1px solid var(--border);
  margin:1.5rem 0;
}

/* Responsive */
@media (max-width:600px){
  .stats-grid { grid-template-columns:1fr; }
}
</style>
</head>

<body>
<header>
  <h1>PLSX Stealth Shield</h1>
  <p>Proof of Privacy v3.1 ‚Ä¢ PulseChain Native</p>
</header>

<main>
// ============ UNIVERSAL WALLET CONNECTION ============
async function connectWallet() {
  try {
    if (window.ethereum) {
      // Detect injected provider (MetaMask / Rabby / Brave / Coinbase)
      provider = new ethers.providers.Web3Provider(window.ethereum, "any");
      await provider.send("eth_requestAccounts", []);
    } else if (window.walletConnectProvider) {
      // Fallback: WalletConnect (if injected)
      provider = new ethers.providers.Web3Provider(window.walletConnectProvider);
      await provider.send("eth_requestAccounts", []);
    } else {
      alert("No wallet detected. Please install MetaMask, Rabby, or connect via WalletConnect.");
      return;
    }

    signer = provider.getSigner();
    account = await signer.getAddress();

    const chainId = await provider.send("eth_chainId", []);
    if (chainId !== PULSECHAIN_ID) {
      try {
        await provider.send("wallet_switchEthereumChain", [{ chainId: PULSECHAIN_ID }]);
      } catch {
        alert("Switch to PulseChain (Chain ID 369)");
        return;
      }
    }

    document.getElementById("walletStatus").textContent = "Connected: " + account.slice(0, 6) + "‚Ä¶" + account.slice(-4);
    document.getElementById("connectBtn").style.display = "none";
    document.getElementById("disconnectBtn").style.display = "inline-block";

    const abi = await fetch("./abi.json").then(r => r.json());
    contract = new ethers.Contract(CONTRACT_ADDR, abi, signer);
    privx = new ethers.Contract(PRIVX_TOKEN, [
      "function approve(address,uint256) external returns(bool)",
      "function allowance(address,address) view returns(uint256)"
    ], signer);

    const plsxAddr = await contract.plsx();
    plsx = new ethers.Contract(plsxAddr, [
      "function approve(address,uint256) external returns(bool)",
      "function allowance(address,address) view returns(uint256)"
    ], signer);

    provider.on("accountsChanged", () => location.reload());
    provider.on("chainChanged", () => location.reload());
  } catch (err) {
    console.error("Wallet connect error:", err);
    alert("Connection failed: " + (err.message || err));
  }
}

function disconnectWallet() {
  provider = signer = account = null;
  document.getElementById("walletStatus").textContent = "Disconnected";
  document.getElementById("connectBtn").style.display = "inline-block";
  document.getElementById("disconnectBtn").style.display = "none";
}
document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("disconnectBtn").onclick = disconnectWallet;

<!-- üìò INTRO / EXPLAINER -->
<div class="explainer">
  <h3>üß≠ Why the PLSX Stealth Shield Exists</h3>
  <p>The blockchain is transparent by design‚Äîevery address and transfer visible forever.  
  <strong>PLSX Stealth Shield</strong> restores privacy through a mathematics-based commit‚Äìreveal mechanism.  
  Each deposit is locked under a <code>keccak256(secret)</code> hash, unlinking it from future withdrawals.</p>
  <p>As many users interact within the 7-day privacy window, transactions blur together into statistical noise.  
  <em>Privacy by participation.</em></p>
</div>

<!-- üí∞ STEP 1 ‚Äî DEPOSIT -->
<div class="section" id="depositSection">
  <h3>üí∞ Step 1 ‚Äì Deposit PLSX</h3>
  <p>1Ô∏è‚É£ Generate your <code>Secret & Deposit Hash</code> using the 
     <a href="https://elitev5.github.io/PrivX/Hash-Generator/PLSX/" target="_blank">official PLSX Hash Generator ‚Üó</a></p>
  <p>2Ô∏è‚É£ Paste your <b>Deposit Hash</b> and enter the amount of PLSX to deposit.</p>
  <input id="depositAmount" placeholder="Amount (PLSX)" />
  <input id="depositHash" placeholder="Deposit Hash (0x‚Ä¶)" />
  <div id="depositFeeEst" style="color:var(--accent2);font-size:.9rem;margin:.4rem 0;">Estimated PRIVX Fee: ‚Äì</div>
  <button id="approvePlsx">Approve PLSX</button>
  <button id="approvePrivx">Approve PRIVX</button>
  <button id="depositBtn">üöÄ Deposit</button>
  <small style="display:block;color:var(--muted);margin-top:.5rem;">
    You must approve both PLSX and PRIVX once before depositing.
  </small>
</div>

<!-- üïµÔ∏è STEP 2 ‚Äî COMMIT -->
<div class="section">
  <h3>üïµÔ∏è Step 2 ‚Äì Commit Your Secret (Activate Stealth Protection)</h3>
  <p>Before withdrawing, commit your <code>Secret Hash</code> to lock your intent on-chain without revealing it.</p>
  <input id="commitHash" placeholder="Commit Hash (0x‚Ä¶)" />
  <button id="commitBtn">üï∂Ô∏è Commit Hash</button>
  <small style="display:block;color:var(--muted);margin-top:.4rem;">
    Wait ‚âà 15 minutes (256 blocks) after committing before withdrawing.
  </small>
</div>

<!-- üíé STEP 3 ‚Äî WITHDRAW -->
<div class="section">
  <h3>üíé Step 3 ‚Äì Withdraw Funds (Stealth Mode)</h3>
  <p>Reveal your secret within 7 days to withdraw to up to 3 wallets.</p>
  <input id="withdrawSecret" placeholder="Secret (UTF-8 string)" />
  <input id="wallet1" placeholder="Wallet 1 (0x‚Ä¶)" />
  <input id="wallet2" placeholder="Wallet 2 (optional)" />
  <input id="wallet3" placeholder="Wallet 3 (optional)" />
  <button id="withdrawBtn">üíé Withdraw</button>
  <small style="color:#f5b914;display:block;margin-top:.5rem;">
    Use fresh wallets for maximum privacy. Anyone with your secret can withdraw within 7 days.
  </small>
</div>

<!-- üî• STEP 4 ‚Äî RECLAIM -->
<div class="section">
  <h3>üî• Step 4 ‚Äì Reclaim Expired Deposits</h3>
  <p>After 7 days, anyone can reclaim unclaimed deposits using their hash.</p>
  <input id="reclaimHash" placeholder="Deposit Hash (0x‚Ä¶)" />
  <div id="reclaimFeeEst" style="color:var(--accent2);font-size:.9rem;margin:.4rem 0;">Estimated PRIVX Fee: ‚Äì</div>
  <button id="reclaimBtn">üî• Reclaim</button>
  <small style="display:block;color:var(--muted);margin-top:.4rem;">
    95 % of PLSX burned ‚Ä¢ 5 % rewarded to caller ‚Ä¢ 1 % PRIVX fee applies.
  </small>
</div>

<!-- üîç STEP 5 ‚Äî CHECK STATUS -->
<div class="section">
  <h3>üîç Step 5 ‚Äì Check Deposit Status</h3>
  <p>Enter your Deposit Hash to view amount, timestamp, and expiration status.</p>
  <input id="checkHash" placeholder="Deposit Hash (0x‚Ä¶)" />
  <button id="checkBtn">üîç Check Status</button>
  <div id="checkResult" style="margin-top:1rem;font-family:var(--mono);color:var(--accent2);"></div>
</div>

<!-- üìä COLLAPSIBLE SHIELD STATS -->
<div class="section">
  <h3 style="cursor:pointer;" id="toggleStats">üìä View Shield Stats</h3>
  <div id="statsPanel">
    <div class="stats-grid">
      <div>Vault PLSX: <span id="vaultPlsx">‚Äì</span></div>
      <div>Pool PRIVX: <span id="poolPrivx">‚Äì</span></div>
      <div>Burned PRIVX: <span id="burnedPrivx">‚Äì</span></div>
      <div>Burned PLSX: <span id="burnedPlsx">‚Äì</span></div>
      <div>Total Withdrawals: <span id="totalWithdraw">‚Äì</span></div>
      <div>Total Reclaimed: <span id="totalReclaimed">‚Äì</span></div>
    </div>
    <small style="color:var(--muted);display:block;margin-top:.8rem;">Auto-updates every 30 seconds from on-chain data.</small>
  </div>
</div>

<!-- üìò BEST PRACTICES -->
<div class="explainer">
  <h3>üìò Best Practices</h3>
  <ul style="padding-left:1.2rem;margin:0;">
    <li>ü™ô Backup your secret offline.</li>
    <li>üîê Keep it private ‚Äî anyone with it can withdraw.</li>
    <li>üï∂Ô∏è Always commit before withdrawing to prevent front-running.</li>
    <li>üïì Withdraw within 7 days or funds become reclaimable.</li>
    <li>üî• Expired deposits burn 95 % of PLSX forever.</li>
    <li>‚öôÔ∏è Verify contract addresses before use.</li>
  </ul>
</div>
<!-- FOOTER -->
<footer>
  <hr>
  <p>PLSX Stealth Shield ‚Ä¢ Proof of Privacy v3.1</p>
  <p>PulseChain Network ‚Ä¢ MIT License ‚Ä¢ Open Source</p>
  <p><a href="https://github.com/elitev5/PrivX" target="_blank">View Source on GitHub</a></p>
</footer>
</main>

<script>
// ============ CONFIG ============
const CONTRACT_ADDR = "0x21a3E97e2347349AC283E972A983c8e6Ee30Bef0";
const PRIVX_TOKEN   = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
const PULSECHAIN_ID = "0x171"; // 369

let provider, signer, account, contract, privx, plsx;

// ============ COLLAPSIBLE STATS ============
document.getElementById("toggleStats").onclick = () => {
  const panel = document.getElementById("statsPanel");
  panel.classList.toggle("open");
};

// ============ WALLET CONNECTION ============
async function connectWallet(){
  if(!window.ethereum){alert("Wallet not detected.");return;}
  provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  account = await signer.getAddress();
  const id = await provider.send("eth_chainId", []);
  if(id !== PULSECHAIN_ID){alert("Switch to PulseChain (369).");return;}
  document.getElementById("walletStatus").textContent = "Connected: " + account.slice(0,6) + "‚Ä¶" + account.slice(-4);
  document.getElementById("connectBtn").style.display="none";
  document.getElementById("disconnectBtn").style.display="inline-block";

  const abi = await fetch("./abi.json").then(r=>r.json());
  contract = new ethers.Contract(CONTRACT_ADDR, abi, signer);
  privx = new ethers.Contract(PRIVX_TOKEN, [
    "function approve(address,uint256) external returns(bool)",
    "function allowance(address,address) view returns(uint256)",
    "function decimals() view returns(uint8)"
  ], signer);
  plsx = new ethers.Contract(await contract.plsx(), [
    "function approve(address,uint256) external returns(bool)",
    "function allowance(address,address) view returns(uint256)"
  ], signer);
}
function disconnectWallet(){
  provider = signer = account = null;
  document.getElementById("walletStatus").textContent = "Disconnected";
  document.getElementById("connectBtn").style.display="inline-block";
  document.getElementById("disconnectBtn").style.display="none";
}
document.getElementById("connectBtn").onclick = connectWallet;
document.getElementById("disconnectBtn").onclick = disconnectWallet;

// ============ FEE ESTIMATION ============
async function estimateFees(){
  const val = document.getElementById("depositAmount").value.trim();
  if(!val || !contract) return;
  try{
    const amt = ethers.utils.parseUnits(val,18);
    const fee = await contract.calculatePrivxFee(amt, await contract.DEPOSIT_FEE_BP());
    document.getElementById("depositFeeEst").textContent = 
      "Estimated PRIVX Fee: " + ethers.utils.formatUnits(fee,18) + " PRIVX";
  }catch{}
}
document.getElementById("depositAmount").addEventListener("input", estimateFees);

async function estimateReclaimFee(){
  if(!contract) return;
  try{
    const amt = ethers.utils.parseUnits("1000",18);
    const fee = await contract.calculatePrivxFee(amt, await contract.RECLAIM_PRIVX_BP());
    document.getElementById("reclaimFeeEst").textContent = 
      "‚âà " + ethers.utils.formatUnits(fee.mul(100).div(amt),18) + "% of value in PRIVX";
  }catch{}
}
estimateReclaimFee();

// ============ CONTRACT INTERACTIONS ============
async function approvePlsx(){
  if(!plsx){alert("Connect wallet first");return;}
  const tx = await plsx.approve(CONTRACT_ADDR, ethers.constants.MaxUint256);
  alert("PLSX approval sent: "+tx.hash);
}
async function approvePrivx(){
  if(!privx){alert("Connect wallet first");return;}
  const tx = await privx.approve(CONTRACT_ADDR, ethers.constants.MaxUint256);
  alert("PRIVX approval sent: "+tx.hash);
}
document.getElementById("approvePlsx").onclick = approvePlsx;
document.getElementById("approvePrivx").onclick = approvePrivx;

async function deposit(){
  const amt=document.getElementById("depositAmount").value.trim();
  const hash=document.getElementById("depositHash").value.trim();
  if(!amt||!hash){alert("Enter amount and deposit hash.");return;}
  const v=ethers.utils.parseUnits(amt,18);
  const tx=await contract.deposit(v,hash);
  alert("Deposit TX: "+tx.hash);
}
document.getElementById("depositBtn").onclick = deposit;

async function commit(){
  const h=document.getElementById("commitHash").value.trim();
  if(!/^0x[0-9a-fA-F]{64}$/.test(h)){alert("Invalid hash.");return;}
  const tx=await contract.commit(h);
  alert("Commit TX: "+tx.hash);
}
document.getElementById("commitBtn").onclick = commit;

async function withdraw(){
  const s=document.getElementById("withdrawSecret").value.trim();
  const adds=["wallet1","wallet2","wallet3"]
    .map(id=>document.getElementById(id).value.trim())
    .filter(a=>ethers.utils.isAddress(a));
  if(!s||!adds.length){alert("Enter secret and at least one address.");return;}
  const tx=await contract.withdraw(s,adds);
  alert("Withdraw TX: "+tx.hash);
}
document.getElementById("withdrawBtn").onclick = withdraw;

async function reclaim(){
  const h=document.getElementById("reclaimHash").value.trim();
  if(!h){alert("Enter hash.");return;}
  const tx=await contract.reclaim(h);
  alert("Reclaim TX: "+tx.hash);
}
document.getElementById("reclaimBtn").onclick = reclaim;

// ============ CHECK STATUS ============
async function checkStatus(){
  const h=document.getElementById("checkHash").value.trim();
  if(!h){alert("Enter hash");return;}
  const d=await contract.deposits(h);
  if(d.amount.eq(0)){document.getElementById("checkResult").textContent="‚ùå Not found";return;}
  const date=new Date(Number(d.timestamp)*1000);
  const exp=new Date(date.getTime()+7*24*60*60*1000);
  const amt=ethers.utils.formatUnits(d.amount,18);
  const claimed=d.claimed;
  document.getElementById("checkResult").innerHTML=
  `Amount: ${amt} PLSX<br>Deposited: ${date.toLocaleString()}<br>Expires: ${exp.toLocaleString()}<br>Status: ${claimed?"‚úÖ Claimed":"üü£ Active"}`;
}
document.getElementById("checkBtn").onclick = checkStatus;

// ============ SYSTEM STATS ============
const pubProv=new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
const pubContract=new ethers.Contract(CONTRACT_ADDR,await fetch("./abi.json").then(r=>r.json()),pubProv);

async function updateStats(){
  try{
    const [v,p,bp,bl,w,r]=await pubContract.getSystemStats();
    document.getElementById("vaultPlsx").textContent=Number(ethers.utils.formatUnits(v,18)).toFixed(2);
    document.getElementById("poolPrivx").textContent=Number(ethers.utils.formatUnits(p,18)).toFixed(2);
    document.getElementById("burnedPrivx").textContent=Number(ethers.utils.formatUnits(bp,18)).toFixed(2);
    document.getElementById("burnedPlsx").textContent=Number(ethers.utils.formatUnits(bl,18)).toFixed(2);
    document.getElementById("totalWithdraw").textContent=w.toString();
    document.getElementById("totalReclaimed").textContent=Number(ethers.utils.formatUnits(r,18)).toFixed(2);
  }catch(e){console.warn("stats update error",e);}
}
updateStats();
setInterval(updateStats,30000);
</script>
</body>
</html>

