<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PrivX Shield Relay â€” Official Helper V9 â€œStealth Withdraw Editionâ€</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
  body{font-family:system-ui,sans-serif;background:#0a0a0a;color:#eee;text-align:center;padding:2rem;max-width:900px;margin:auto}
  h1{color:#8b5cf6;font-size:2rem;margin-bottom:.3rem;display:flex;align-items:center;justify-content:center;gap:.5rem}
  h1 img{width:48px;filter:drop-shadow(0 0 10px #8b5cf6);animation:logoGlow 3s infinite alternate;}
  @keyframes logoGlow{from{filter:drop-shadow(0 0 6px #8b5cf6);}to{filter:drop-shadow(0 0 20px #8b5cf6);}}
  h3{color:#00ffcc}
  a{color:#8b5cf6;text-decoration:none}
  a:hover{text-decoration:underline;color:#a36fff}
  button{background:#5c00ff;color:#fff;padding:.6rem 1rem;border:none;border-radius:8px;font-size:1rem;cursor:pointer;margin:.3rem;transition:.2s}
  button:hover{background:#6f14ff}
  button:disabled{background:#333;cursor:not-allowed}
  input{width:90%;max-width:420px;margin:.3rem 0;padding:.6rem;border-radius:8px;border:none;font-size:1rem;text-align:center;background:#161616;color:#00ffcc}
  .section{border:1px solid #222;border-radius:12px;padding:1.3rem;margin:1.5rem 0;background:#111}
  #status{margin-bottom:1rem;color:#f55;font-weight:bold}
  footer{margin-top:2rem;font-size:.9rem;color:#777}
  small{color:#aaa;display:block;margin-top:.5rem}
  .warning{color:#ffcc00}
  hr{border:none;border-top:1px solid #333;margin:1.5rem 0}
  .ca-box{background:#161616;padding:0.6rem;border-radius:8px;margin:0.3rem 0;word-break:break-all}
  .ca-copy{background:#333;color:#00ffcc;border:none;border-radius:6px;padding:0.3rem 0.7rem;cursor:pointer;font-size:0.85rem;margin-left:0.4rem;}
  .ca-copy:hover{background:#555;}
  .explainer{background:#141414;border-left:5px solid #8b5cf6;padding:1rem;border-radius:8px;text-align:left;line-height:1.5em;margin-bottom:1.5rem;}
  .hashList{background:#0f0f0f;border-radius:10px;padding:1rem;margin-top:1rem;text-align:left;max-height:220px;overflow-y:auto;}
  .hashItem{margin:0.5rem 0;padding:0.5rem;background:#161616;border-radius:8px;font-size:0.9rem;word-break:break-all;}
  .hashItem button{background:#ff006e;padding:0.3rem 0.8rem;font-size:0.8rem;border-radius:6px;margin-left:0.5rem;}
  .timer-glow{color:#ffcc00;text-shadow:0 0 10px #ffcc00,0 0 20px #ffaa00;animation:pulseGlow 2s infinite alternate;}
  @keyframes pulseGlow{from{text-shadow:0 0 10px #ffcc00,0 0 20px #ffaa00;}to{text-shadow:0 0 20px #ffaa00,0 0 40px #ff8800;}}
  .feed{background:#0d0d0d;border:1px solid #222;border-radius:10px;padding:1rem;margin-top:1rem;text-align:left;max-height:180px;overflow-y:auto;}
  .feed-entry{font-size:0.9rem;margin:0.4rem 0;}
  .feed-entry span{font-weight:bold;}
  .glow{color:#8b5cf6;text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff;}
</style>

</head>

<body>
<!-- ğŸ”· PrivX Header (Glowing Logo + Subtitle + Fade-In, Large Version) -->
<div class="privx-header">
  <h1>
    <img src="PRIV.png" alt="PrivX Shield Logo">
  </h1>
  <p class="edition">ğŸ›¡ï¸ PrivX Shield Relay â€” V9 â€œStealth Withdraw Editionâ€</p>
  <p class="credits">Built by Elite Team6 â€¢ Â© Elite Labs â€¢ 2025</p>
</div>
<!-- ğŸ”— WALLET CONNECTION -->
<div id="walletConnect" style="margin:1.2rem 0;">
  <button id="connect">ğŸ”— Connect Wallet</button>
  <button id="disconnect" style="display:none;">âŒ Disconnect</button>
  <div id="status" style="margin-top:0.5rem;color:#aaa;">Not connected</div>
  <small style="color:#777;">Required for deposits, commits, and withdrawals.</small>
</div>
<style>
/* --- Header Fade + Glow Animation --- */
.privx-header {
  text-align: center;
  margin-bottom: 1.8rem;
  opacity: 0;
  animation: fadeIn 1.6s ease-out forwards;
}

.privx-header h1 {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0;
  animation: glowPulse 4s ease-in-out infinite alternate;
}

.privx-header img {
  width: 90%;
  max-width: 540px; /* ğŸŸ£ larger logo for desktop */
  height: auto;
  filter: drop-shadow(0 0 10px rgba(139,92,246,0.8));
  transition: transform 0.5s ease, filter 0.5s ease;
}

.privx-header img:hover {
  transform: scale(1.04);
  filter: drop-shadow(0 0 20px rgba(139,92,246,1)) drop-shadow(0 0 40px rgba(91,0,255,0.8));
}

.privx-header .edition {
  color: #8b5cf6;
  font-weight: bold;
  font-size: 1.4rem;
  margin-top: 0.6rem;
  text-shadow: 0 0 10px rgba(139,92,246,0.8), 0 0 20px rgba(91,0,255,0.6);
}

.privx-header .credits {
  color: #00ffcc;
  font-size: 1rem;
  margin-top: 0.4rem;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes glowPulse {
  0% { filter: drop-shadow(0 0 6px rgba(139,92,246,0.6)) drop-shadow(0 0 12px rgba(91,0,255,0.4)); }
  50% { filter: drop-shadow(0 0 18px rgba(139,92,246,0.9)) drop-shadow(0 0 40px rgba(91,0,255,0.8)); }
  100% { filter: drop-shadow(0 0 10px rgba(139,92,246,0.6)) drop-shadow(0 0 25px rgba(91,0,255,0.5)); }
}

/* ğŸ§­ Responsive tweak for mobile */
@media (max-width: 600px) {
  .privx-header img {
    max-width: 320px;
  }
  .privx-header .edition {
    font-size: 1.1rem;
  }
}
</style>

<!-- ğŸŒ WHY PRIVX SECTION -->
<div class="explainer" id="why-privx">
  <h3 style="color:#00ffcc;">ğŸŒ Why PrivX Exists â€” Privacy That Accelerates With Participation</h3>
  <p><b>PrivX isnâ€™t about hiding â€” itâ€™s about blending in faster.</b></p>
  <p>Modern blockchains are transparent by design. Every wallet, every transfer, every pattern is visible forever.  
     <b>PrivX</b> transforms this transparency into a collective privacy shield, powered by mathematics â€” not secrecy.</p>
  <hr>
  <h4 style="color:#00ffcc;">ğŸ§  The Core Mechanism</h4>
  <p>Each deposit in the Shield Relay is locked under a <code>keccak256(secret)</code> hash.  
     The <b>secret</b> remains private, while the <b>hash</b> becomes your on-chain proof.  
     When you or a recipient reveal the secret to withdraw, it matches the stored hash and releases the tokens.</p>
  <p>As hundreds or thousands of users do this â€” at different times and with different amounts â€”  
     it becomes statistically impossible to know which deposit maps to which withdrawal.</p>
  <hr>
  <h4 style="color:#00ffcc;">ğŸ•¶ï¸ Stealth Withdraw Layer (New in V9)</h4>
  <p>V9 introduces a <b>Commitâ€“Reveal stealth layer</b> that protects your withdrawal from mempool front-running.  
     Before you withdraw, you must first <b>commit</b> your withdrawal secret hash â€” this quietly signals intent without revealing any data.  
     After a short window (~5 minutes), you can <b>reveal</b> your secret to finalize the withdrawal.  
     This ensures your action cannot be copied, traced, or intercepted while pending in the mempool.</p>
  <blockquote style="border-left:3px solid #8b5cf6;padding-left:1rem;margin:1rem 0;color:#ccc;">
    â€œYour withdrawal vanishes before it appears â€” stealth by design.â€
  </blockquote>
  <h4 style="color:#00ffcc;">ğŸ•“ The 7-Day Obfuscation Window</h4>
  <p>Every deposit remains locked for up to 7 days.  
     This period forms a temporal privacy field â€” no one can tell <i>when</i> a deposit and withdrawal are linked.  
     As hundreds of users deposit and withdraw at varying times within this rolling window,  
     the transactional entropy increases, and linkability collapses into statistical noise.</p>
</div>
<!-- ğŸ“œ Official CAs -->
<div class="section" style="background:#141414;">
  <h3>ğŸ“œ Official Contract Addresses</h3>

  <div class="ca-box">
    ğŸ’  <b>PRIVX Token</b><br>
    <code id="caToken">0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986</code>
    <button class="ca-copy" onclick="copyCA('caToken')">Copy</button><br>
    <a href="https://scan.pulsechain.com/address/0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986" target="_blank">
      View on PulseChainScan â†—
    </a>
  </div>

  <div class="ca-box">
    ğŸ›¡ï¸ <b>PrivX Shield Relay V9 â€” Stealth Edition</b><br>
    <code id="caRelay">0x264cD72e4c7F0Df7f02117b1A82C5dc8650308bf</code>
    <button class="ca-copy" onclick="copyCA('caRelay')">Copy</button><br>
    <a href="https://scan.pulsechain.com/address/0x264cD72e4c7F0Df7f02117b1A82C5dc8650308bf" target="_blank">
      View on PulseChainScan â†—
    </a><br>
    <small style="color:#00ff99;">âœ… Live & Immutable â€” Deployed on PulseChain Mainnet</small>
  </div>

  <small style="display:block;margin-top:.8rem;color:#aaa;">
    ğŸ§© Verified Contracts â€¢ No Admin â€¢ No Upgrades â€¢ 100% On-Chain Autonomy
  </small>
</div>


<!-- ğŸ’ REWARD PROTOCOL -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’ The Reward Protocol â€” Earning While Strengthening Privacy</h3>
  <p>The PrivX V9 Relay continues the adaptive reward model â€” no pre-seeded airdrop, only earned rewards.  
     Every withdrawal and reclaim contributes fees to replenish the reward pool automatically.</p>
  <ul style="text-align:left;line-height:1.5em;">
    <li>ğŸŸ£ <b>20% of all withdrawal fees</b> go directly into the live reward pool.</li>
    <li>ğŸ’  Reclaimers still receive 5% of expired deposits.</li>
    <li>ğŸ”¥ 80% of withdrawal fees and 95% of expired deposits are permanently burned.</li>
    <li>âš¡ The pool self-balances dynamically as participation grows.</li>
  </ul>
  <p style="color:#8b5cf6;font-weight:bold;margin-top:.8rem;">
    â€œIn PrivX V9, privacy and rewards evolve together â€” activity fuels both.â€
  </p>
</div>

<!-- ğŸ’  TOKENOMICS -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’  PrivX Tokenomics</h3>
  <p><b>21 million PRIVX total supply</b> â€¢ No minting â€¢ No admin â€¢ 100% deflationary.  
     The Shield Relay autonomously burns supply on every use and distributes rewards via protocol events.</p>
  <ul style="text-align:left;line-height:1.5em;">
    <li>ğŸ§± 0.3% fee on all withdrawals</li>
    <li>ğŸ”¥ 80% burned instantly</li>
    <li>ğŸ’ 20% sent to reward pool</li>
    <li>â³ Unclaimed deposits after 7 days â†’ 95% burn / 5% reclaim reward</li>
  </ul>
</div>

<!-- ğŸ”¥ Burn Counter -->
<div class="section" style="background:#121212;">
  <h3>ğŸ”¥ Total PRIVX Burned</h3>
  <h2 id="burnCounter" class="glow">Loading...</h2>
  <small id="burnUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>

<!-- ğŸ”’ Vault Tracker -->
<div class="section" style="background:#121212;">
  <h3>ğŸ”’ Shield Vault Tracker</h3>
  <p>Total PRIVX held by the Shield Relay (User Deposits):</p>
  <h2 id="vaultBalance" style="color:#00ff99;font-weight:bold;">Loading...</h2>
  <small id="vaultUpdate">â³ Waiting for dataâ€¦</small>
</div>

<!-- ğŸ’ Reward Pool Tracker -->
<div class="section" style="background:#121212;">
  <h3>ğŸ’ Active Reward Pool</h3>
  <p>Total PRIVX currently available for rewards (from fees and reclaims):</p>
  <h2 id="rewardPool" style="color:#8b5cf6;font-weight:bold;">Loading...</h2>
  <small id="rewardUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>

<!-- ğŸ“Š NETWORK PARTICIPATION (live metric) -->
<div class="section" style="background:#121212;">
  <h3>ğŸ›¡ï¸ Shield Strength (Network Privacy Field)</h3>
  <p>
    Tracks total PRIVX in motion â€” deposits, burns, and reclaims â€” 
    the pulse of the Shield. Privacy increases with % Updated every 20 seconds.
  </p>
  <h2 id="networkActivity" class="glow-pulse">Loading...</h2>
  <small id="networkStatusMsg" style="display:block;margin-top:.5rem;color:#aaa;">
  â³ Initializing shield fieldâ€¦
</small>

<!-- Live Feed -->
<div id="shieldFeed" class="feed" style="margin-top:1rem;text-align:left;">
  <div class="feed-entry">ğŸ§  System booted â€” monitoring shield events.</div>
</div>

  <small id="networkUpdate">â³ Fetching on-chain dataâ€¦</small>
</div>

<style>
  /* ğŸŒŒ soft pulse animation for the main number */
  .glow-pulse {
    color:#8b5cf6;
    text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff,0 0 30px #3c00aa;
    animation:pulseMetric 2s infinite alternate;
  }
  @keyframes pulseMetric {
    from { text-shadow:0 0 10px #8b5cf6,0 0 20px #5c00ff; }
    to   { text-shadow:0 0 25px #9d72ff,0 0 45px #8b5cf6; }
  }
@keyframes shieldPulse {
  0%   { transform: scale(1); opacity: 0.9; }
  50%  { transform: scale(1.03); opacity: 1; }
  100% { transform: scale(1); opacity: 0.9; }
  }
  @keyframes auraPulse {
  0%   { box-shadow: 0 0 10px rgba(0,255,100,0.1); }
  50%  { box-shadow: 0 0 40px rgba(0,255,100,0.25); }
  100% { box-shadow: 0 0 10px rgba(0,255,100,0.1); }
}
.shield-section-active {
  animation: auraPulse 6s ease-in-out infinite;
  border: 1px solid rgba(0,255,150,0.25);
  transition: all .6s ease;
}
.feed-entry {
  font-size: .9rem;
  margin: .3rem 0;
  opacity: .9;
  animation: entryGlow 1s ease-out;
}

@keyframes entryGlow {
  0%   { text-shadow: 0 0 15px rgba(255,255,255,0.6); }
  100% { text-shadow: none; }
}

.feed-entry.fade {
  opacity: 0.5;
  transition: opacity 2s ease;
}


#networkActivity {
  animation: shieldPulse 3s ease-in-out infinite;
}

/* ---- Color-coded live feed entries ---- */
.feed-entry[data-type="weak"] { color: #ff6666; }
.feed-entry[data-type="stabilizing"] { color: #ffcc00; }
.feed-entry[data-type="optimized"] { color: #00ff99; }
.section.shield-section-active[data-zone="optimized"] {
  box-shadow: 0 0 25px rgba(0,255,150,0.25), inset 0 0 25px rgba(0,255,150,0.15);
}
.section.shield-section-active[data-zone="stabilizing"] {
  box-shadow: 0 0 25px rgba(255,220,0,0.25), inset 0 0 25px rgba(255,220,0,0.15);
}
.section.shield-section-active[data-zone="weak"] {
  box-shadow: 0 0 25px rgba(255,80,80,0.25), inset 0 0 25px rgba(255,80,80,0.15);
}

</style>

<!-- ğŸ’° STEP 1 â€” DEPOSIT -->
<div class="section">
  <h3>ğŸ’° Step 1 â€” Deposit PRIVX</h3>
  <p>1ï¸âƒ£ Generate your <b>Commit, Secret, & Deposit Hashes</b> using the <a href="https://elitev5.github.io/PrivX/Hash-Generator/V9" target="_blank">official Hash Generator â†—</a>.</p>
  <p>2ï¸âƒ£ Copy your <b>Deposit Hash</b> and paste it below.</p>
  <p>3ï¸âƒ£ Enter how much PRIVX you want to deposit (e.g. 10).</p>
  <input id="depositAmount" placeholder="Amount (e.g. 10)" /><br/>
  <input id="depositHash" placeholder="Deposit Hash (0xâ€¦)" /><br/>
  <button id="approveBtn">âœ… Approve PRIVX</button>
  <button id="depositBtn">ğŸš€ Deposit</button>
  <small>âš™ï¸ Approve once, then deposit anytime with new hashes.</small>
</div>
  
<!-- STEP 2 â€” COMMIT SECRET -->
<div class="section" style="background:#161616;">
  <h3>ğŸ•µï¸ Step 2 â€” Commit Your Secret (Activate Stealth Protection)</h3>
  <p>
    Before withdrawing, you must <b>commit</b> your Secret.  
    This step quietly registers your intent on-chain without revealing any data in the mempool.
    It ensures that when you later reveal your Secret to withdraw, no one can copy or front-run your transaction.
  </p>

  <input id="commitHashInput" placeholder="Paste your Commit Hash (from Hash Generator)" /><br/>
<button id="commitBtn">ğŸ•¶ï¸ Commit Hash</button>
<small>
  ğŸ’¡ Paste the exact <b>Commit Hash</b> generated with your Secret and Wallet.<br>
  You no longer need to type your Secret into this app. The hash flows directly to the chain.
</small>


  <small>
    â³ Wait about 5 minutes after committing before withdrawing.<br>
    ğŸ’¡ <b>Tip:</b> You donâ€™t need to calculate any â€œcommit hash.â€  
    The system automatically derives it from your Secret for you â€” just enter the same Secret you generated earlier.
  </small>
</div>
  
<!-- ğŸ’ STEP 3 â€” WITHDRAW -->
<div class="section">
  <h3>ğŸ’ Step 3 â€” Withdraw Funds (Stealth Mode)</h3>
  <p>After committing your secret, withdraw within 7 days to up to 3 wallets.  
     Withdrawals without a valid commit will be rejected by the contract.</p>
  <input id="withdrawSecret" placeholder="Secret (UTF-8 string)" /><br/>
  <input id="wallet1" placeholder="Wallet 1 (0xâ€¦)" /><br/>
  <input id="wallet2" placeholder="Wallet 2 (optional)" /><br/>
  <input id="wallet3" placeholder="Wallet 3 (optional)" /><br/>
  <button id="withdrawBtn">ğŸ’ Withdraw (Stealth Mode)</button>
  <small class="warning">
ğŸ”’ Using previously used wallets (including your connected one) can link your deposits and withdrawals through on-chain analysis.  
ğŸ’¡ Use new wallets to maximize privacy.
</small>
 <small class="warning">âš ï¸ Anyone with your Secret can withdraw within 7 days â€” keep it safe.</small>
</div>

<!-- ğŸ”¥ â€” RECLAIM -->
<div class="section">
  <h3>ğŸ”¥ Reclaim Expired Deposits</h3>
  <p>After 7 days, anyone can reclaim unclaimed deposits using their hash.</p>
  <input id="reclaimHash" placeholder="Deposit Hash (0xâ€¦)" /><br/>
  <button id="reclaimBtn">ğŸ”¥ Reclaim</button>
  <small>ğŸ’ Reclaim rewards 5% to the caller â€¢ 95% burnt forever ğŸ”¥</small>
</div>
<!-- ğŸ§© CLAIM HELPER -->
<div class="section" style="background:#161616;">
  <h3>ğŸ§© Claim Helper â€” Find Unclaimed Deposits</h3>
  <p>View all expired deposits ready to reclaim. Copy or reclaim directly below.</p>
  <button id="loadReclaimable">ğŸ” Load Reclaimable Hashes</button>
  <div id="reclaimList" class="hashList">Press to viewâ€¦</div>
  <small>Auto-refreshes every 30 seconds â€¢ View-only â€¢ No wallet needed.</small>
</div>

<!-- ğŸ” DEPOSIT CHECKER -->
<div class="section" style="background:#101010;">
  <h3>ğŸ” Check Your Deposit Status</h3>
  <p>Enter your <b>Deposit Hash</b> to see amount, date, and status (plus countdown timer).</p>
  <input id="checkHash" placeholder="Deposit Hash (0xâ€¦)" /><br/>
  <button id="checkBtn">ğŸ” Check Status</button>
  <div id="checkResult" style="margin-top:1rem;color:#00ff99;font-family:monospace;"></div>
  <small>Works even without wallet connection.</small>
</div>

<!-- ğŸ“˜ HOW IT WORKS -->
<div class="section" style="background:#131313;">
  <h3>ğŸ“˜ How It Works â€” Step by Step</h3>
  <ol style="text-align:left;line-height:1.6em;">
    <li><b>Generate Secret & Hash</b> â€” Use the <a href="https://elitev5.github.io/PrivX/Hash-Generator/V9" target="_blank">Hash Generator</a> to create a unique pair.</li>
    <li><b>Deposit PRIVX</b> â€” Enter hash and amount, approve once, then deposit.</li>
    <li><b>Commit</b> â€” When ready to withdraw (within 7 Days), first submit your commit hash (this activates stealth mode).</li>
    <li><b>Withdraw</b> â€” Wait a few minutes (3-5) after commit, then submit your secret to withdraw (0.3 % burn).</li>
    <li><b>Reclaim</b> â€” After 7 days anyone can reclaim if you forget or lose Secret (95 % burn / 5 % reward).</li>
    <li><b>Check</b> â€” Verify any deposit on-chain by its hash.</li>
  </ol>

  <h3>ğŸ§­ Best Practices</h3>
  <ul style="text-align:left;line-height:1.6em;">
    <li>ğŸª™ <b>Backup your Secret.</b> Lose it = lose access.</li>
    <li>ğŸ” <b>Keep your Secret private.</b> Anyone with it can withdraw within 7 days.</li>
    <li>ğŸ•¶ï¸ <b>Always Commit before Withdraw.</b> This hides your intent and prevents mempool tracking.</li>
    <li>ğŸ•“ <b>Respect the 7-day window.</b> Withdraw on time or funds become claimable.</li>
    <li>ğŸ”¥ <b>Expired deposits are burned.</b> 95% destroyed â€¢ 5% rewarded â€¢ no middlemen.</li>
    <li>âš™ï¸ <b>Verify contract addresses.</b> Only use official PRIVX and Shield Relay CAs.</li>
    <li>ğŸ§© <b>More users = more privacy.</b> Each deposit adds noise and protection.</li>
    <li>âš ï¸ <b>Testing Phase:</b> Do NOT send more than you can afford to lose.</li>
  </ul>

  <blockquote style="border-left:3px solid #8b5cf6;padding-left:1rem;margin:1rem 0;color:#ccc;">
    â€œThe 7-day window forms the privacy horizon.  
    The commit hides your step. The reveal completes your path unseen.â€
  </blockquote>

  <p style="color:#8b5cf6;font-weight:bold;margin-top:1rem;">â€œThe more we walk together, the harder we are to follow.â€</p>
  <p style="color:#00ffcc;">PrivX â€” Privacy by participation. Strength in numbers.</p>
</div>

<footer>
  <hr>
  <p>PulseChain Native â€¢ MIT License â€¢ Open Source</p>
  <p><a href="https://github.com/elitev5/PrivX" target="_blank" rel="noopener noreferrer">View Source on GitHub</a></p>
  <p style="margin-top:1rem;color:#8b5cf6;font-weight:bold;">â€œWe donâ€™t hide. We outnumber.â€</p>
</footer>

<!-- ==== MAIN LOGIC (V9 with Commitâ€“Reveal) ==== -->
<script>
// === Inline Copy Function with Animated Feedback ===
function copyCA(id) {
  const el = document.getElementById(id);
  if (!el) return console.warn("Element not found:", id);
  const text = el.textContent.trim();

  // Basic validation
  if (!text.startsWith("0x")) {
    console.warn("Invalid address:", text);
    return;
  }

  navigator.clipboard.writeText(text).then(() => {
    const btn = el.nextElementSibling;
    if (btn && btn.classList.contains("ca-copy")) {
      const original = btn.textContent;
      btn.textContent = "âœ… Copied!";
      btn.style.background = "#00ff99";
      btn.style.color = "#000";
      btn.style.boxShadow = "0 0 10px #00ff99";
      setTimeout(() => {
        btn.textContent = original;
        btn.style.background = "#333";
        btn.style.color = "#00ffcc";
        btn.style.boxShadow = "none";
      }, 1200);
    }
  }).catch(err => {
    console.error("Copy failed:", err);
  });
}
// === GLOBAL VARIABLES ===
const relayAddress = "0x264cD72e4c7F0Df7f02117b1A82C5dc8650308bf"; // ğŸ”§ update when deployed
const tokenAddress = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
const PULSECHAIN_ID = "0x171"; // PulseChain (chainId 369)
let provider, signer, contract, account, privx;
let abi;

// === UNIVERSAL WALLET CONNECT FUNCTIONS ===
async function connect() {
  try {
    if (typeof window.ethereum === "undefined") {
      alert("âš ï¸ No wallet detected. Please install MetaMask, Rabby, or another EVM-compatible wallet.");
      return;
    }

    // Detect multiple providers (MetaMask, Rabby, Coinbase, etc.)
    if (window.ethereum.providers?.length) {
      const selected = window.ethereum.providers.find(p => p.isRabby) || window.ethereum.providers[0];
      provider = new ethers.providers.Web3Provider(selected, "any");
    } else {
      provider = new ethers.providers.Web3Provider(window.ethereum, "any");
    }

    // Request access
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    account = await signer.getAddress();

    // Network check
    const chainId = await provider.send("eth_chainId", []);
    if (chainId !== PULSECHAIN_ID) {
      alert("âš ï¸ Please switch your wallet to PulseChain (Chain ID 369).");
      return;
    }

    // Update UI
    document.getElementById("status").textContent = "âœ… Connected: " + account.slice(0, 6) + "â€¦" + account.slice(-4);
    document.getElementById("status").style.color = "#00ff99";
    document.getElementById("disconnect").style.display = "inline-block";
    ["approveBtn", "depositBtn", "withdrawBtn", "reclaimBtn", "commitBtn"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.disabled = false;
    });

    // Initialize contracts (safe even if not yet deployed)
    contract = new ethers.Contract(relayAddress, abi, signer);
    privx = new ethers.Contract(
  tokenAddress,
  [
    "function approve(address,uint256) external returns (bool)",
    "function allowance(address owner,address spender) view returns (uint256)",
    "function balanceOf(address account) view returns (uint256)",
    "function transfer(address to,uint256 amount) external returns (bool)",
    "function decimals() view returns (uint8)"
  ],
  signer
);

    // Handle network/account changes
    provider.on("accountsChanged", () => window.location.reload());
    provider.on("chainChanged", () => window.location.reload());

    console.log("âœ… Wallet connected:", account);
  } catch (err) {
    console.error("Wallet connection failed:", err);
    alert("âŒ Wallet connection failed.\n" + err.message);
  }
}

function disconnect() {
  provider = signer = contract = privx = account = null;
  document.getElementById("status").textContent = "âŒ Disconnected";
  document.getElementById("status").style.color = "#f55";
  document.getElementById("disconnect").style.display = "none";

  ["approveBtn", "depositBtn", "withdrawBtn", "reclaimBtn", "commitBtn"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = true;
  });

  console.log("ğŸ”Œ Wallet disconnected");
}

// === MAIN LOGIC ===
(async () => {
  // Load ABI + Public provider
  abi = await fetch("./abi.json").then(r => r.json());
  const pubProv = new ethers.providers.JsonRpcProvider("https://rpc.pulsechain.com");
  const pubContract = new ethers.Contract(relayAddress, abi, pubProv);

  // Disable buttons until connected
  ["approveBtn", "depositBtn", "withdrawBtn", "reclaimBtn", "commitBtn"].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = true;
  });

  // ====== VIEW UPDATERS ======
  async function updateVaultBalance() {
    try {
      const b = await pubContract.totalVaultBalance();
      document.getElementById("vaultBalance").textContent = ethers.utils.formatUnits(b, 18) + " PRIVX";
      document.getElementById("vaultUpdate").textContent = "âœ… Updated " + new Date().toLocaleTimeString();
    } catch (e) {
      document.getElementById("vaultBalance").textContent = "Error";
    }
  }

  async function updateBurnCounter() {
    try {
      const burned = await pubContract.totalBurned();
      document.getElementById("burnCounter").textContent = ethers.utils.formatUnits(burned, 18) + " PRIVX ğŸ”¥";
      document.getElementById("burnUpdate").textContent = "âœ… Synced " + new Date().toLocaleTimeString();
    } catch (e) {
      document.getElementById("burnCounter").textContent = "Error";
    }
  }

  async function updateRewardPool() {
  try {
    // âœ… Your contract exposes rewardPool() automatically
    const poolValue = await pubContract.rewardPool();
    const formatted = ethers.utils.formatUnits(poolValue, 18);
    document.getElementById("rewardPool").textContent = `${formatted} PRIVX ğŸŸ£`;
    document.getElementById("rewardUpdate").textContent = `âœ… Synced ${new Date().toLocaleTimeString()}`;
  } catch (e) {
    // Graceful error handling if ABI mismatch or read failure
    document.getElementById("rewardPool").textContent = "Error";
    document.getElementById("rewardUpdate").textContent = `âš ï¸ ${e.message}`;
    console.warn("âš ï¸ updateRewardPool failed:", e);
    }
  }

  async function ensurePulse() {
    const c = await window.ethereum.request({ method: "eth_chainId" });
    if (c !== PULSECHAIN_ID) {
      alert("âš ï¸ Please switch to PulseChain.");
      return false;
    }
    return true;
  }
// ğŸ›¡ï¸ Shield Strength Live Tracker
async function updateShieldStrength() {
  try {
    const vault = await pubContract.totalVaultBalance();
    const burned = await pubContract.totalBurned();
    const reclaimed = await pubContract.totalReclaimed?.() ?? ethers.BigNumber.from(0);

    const totalActive = vault.add(reclaimed);
    const totalActivity = vault.add(burned).add(reclaimed);
    const pool = await pubContract.rewardPool();

    // --- Calculate "strength" score (simple heuristic) ---
    const ratio = totalActive.mul(10000).div(totalActivity.add(1)).toNumber() / 100;
    const poolBoost = Math.min(Number(ethers.utils.formatUnits(pool, 18)) / 1000, 20); // + up to 20%

    let score = ratio + poolBoost;
    if (score > 100) score = 100;

    // --- Determine color zone ---
    let color, label;
    if (score >= 70) {
      color = "#00ff99"; label = "ğŸŸ¢ Optimized";
    } else if (score >= 40) {
      color = "#ffcc00"; label = "ğŸŸ¡ Stabilizing";
    } else {
      color = "#ff6666"; label = "ğŸ”´ Weak";
    }

    // --- Update main metric display ---
    const activityEl = document.getElementById("networkActivity");
    activityEl.style.color = color;
    activityEl.innerHTML = `${score.toFixed(1)}% Shield Strength<br><small>${label}</small>`;

    document.getElementById("networkUpdate").textContent = `âœ… Updated ${new Date().toLocaleTimeString()}`;
    document.getElementById("networkStatusMsg").textContent = "Shield status active.";

    // --- Animate background aura color ---
    const section = activityEl.closest(".section");
    section.classList.add("shield-section-active");
    section.dataset.zone = label.includes("Weak")
  ? "weak"
  : label.includes("Stabilizing")
  ? "stabilizing"
  : "optimized";

    section.style.borderColor = color + "44";

    // --- Live Feed Entry ---
    const feed = document.getElementById("shieldFeed");
    const entry = document.createElement("div");
    entry.className = "feed-entry";
    entry.dataset.type = label.includes("Weak")
      ? "weak"
      : label.includes("Stabilizing")
      ? "stabilizing"
      : "optimized";
    entry.textContent = `${new Date().toLocaleTimeString()} â€” ${label}: Vault ${ethers.utils.formatUnits(vault, 18)} PRIVX, Pool ${ethers.utils.formatUnits(pool, 18)} PRIVX`;
    feed.prepend(entry);

    // Fade old entries
    const allEntries = feed.querySelectorAll(".feed-entry");
    if (allEntries.length > 10) allEntries[allEntries.length - 1].remove();
    allEntries.forEach((e, i) => { if (i > 5) e.classList.add("fade"); });
  } catch (e) {
    console.warn("Shield strength update failed:", e);
    document.getElementById("networkStatusMsg").textContent = "âš ï¸ Error reading shield metrics.";
  }
}
  // ====== MAIN ACTIONS ======
  async function commitHashDirect() {
  const commitHash = document.getElementById("commitHashInput").value.trim();
  if (!commitHash) return alert("âš ï¸ Enter your Commit Hash first (from generator).");
  if (!/^0x([A-Fa-f0-9]{64})$/.test(commitHash)) {
    return alert("âŒ Invalid Commit Hash format. It should start with 0x and be 66 characters total.");
  }
  if (!await ensurePulse()) return;

  try {
    const tx = await contract.commit(commitHash);
    alert(`ğŸ•¶ï¸ Commit Hash submitted directly!\nHash: ${commitHash}\nTx: ${tx.hash}\nâœ… Wait ~5 minutes, then withdraw using your Secret.`);
  } catch (e) {
    alert("Commit failed:\n" + e.message);
  }
}


  async function approve() {
    try {
      const tx = await privx.approve(relayAddress, ethers.constants.MaxUint256);
      alert("âœ… Approval sent:\n" + tx.hash);
    } catch (e) {
      alert("Approval failed:\n" + e.message);
    }
  }

  async function deposit() {
  const amt = document.getElementById("depositAmount").value.trim();
  const h = document.getElementById("depositHash").value.trim();

  if (!amt || !h) {
    alert("âš ï¸ Please enter both amount and deposit hash.");
    return;
  }

  if (!await ensurePulse()) return;

  try {
    console.log("ğŸ’° Deposit requested:", amt, "PRIVX");
    console.log("ğŸ”¹ Using Deposit Hash:", h);
    console.log("ğŸ”¹ From wallet:", account);

    // Parse amount to correct decimals (18)
    const v = ethers.utils.parseUnits(amt, 18);

    // Confirm token approval before deposit
    const allowance = await privx.allowance(account, relayAddress);
    if (allowance.lt(v)) {
      alert("âš ï¸ Insufficient allowance. Please approve PRIVX first.");
      return;
    }

    // Send the deposit transaction
    const tx = await contract.deposit(v, h);
    console.log("ğŸ“¡ Deposit TX sent:", tx.hash);

    // Wait for confirmation
    const receipt = await tx.wait();
    console.log("âœ… Deposit confirmed in block:", receipt.blockNumber);

    // User feedback
    alert(
      `âœ… Deposit confirmed on-chain!\n\n` +
      `Amount: ${amt} PRIVX\n` +
      `Deposit Hash: ${h}\n` +
      `Tx Hash: ${tx.hash}\n` +
      `Block: ${receipt.blockNumber}\n\n` +
      `View on PulseScan:\nhttps://scan.pulsechain.com/tx/${tx.hash}\n\n` +
      `ğŸ’¡ Tip: Save this hash. Itâ€™s required for reclaiming if not withdrawn within 7 days.`
    );

    // Refresh display
    updateVaultBalance();
    updateRewardPool();
  } catch (e) {
    console.error("âŒ Deposit failed:", e);

    const msg = e.data?.message || e.message || "Unknown error";
    alert(
      `âŒ Deposit failed:\n\n${msg}\n\n` +
      `ğŸ’¡ Common causes:\n` +
      `â€¢ Deposit hash already used.\n` +
      `â€¢ Wrong format (should start with 0x).\n` +
      `â€¢ Not enough PRIVX or allowance.\n` +
      `â€¢ Wallet not connected or wrong network.`
    );
  }
}


  async function withdraw() {
  const s = document.getElementById("withdrawSecret").value.trim();
  const addrs = ["wallet1", "wallet2", "wallet3"]
    .map(id => document.getElementById(id).value.trim())
    .filter(a => a && ethers.utils.isAddress(a));

  if (!s || addrs.length === 0)
    return alert("âš ï¸ Enter your Secret and at least one valid wallet address.");

  if (!await ensurePulse()) return;

  try {
    console.log("ğŸ”¹ Withdraw initiated with Secret:", s);
    console.log("ğŸ”¹ Recipient wallets:", addrs);

    // Send withdrawal transaction
    const tx = await contract.withdraw(s, addrs);
    console.log("ğŸ“¡ Withdraw TX sent:", tx.hash);

    // Wait for confirmation
    const receipt = await tx.wait();
    console.log("âœ… Withdraw TX confirmed in block:", receipt.blockNumber);

    // Success alert with link
    alert(
      `ğŸ’ Withdraw successful (Stealth Mode)\n\n` +
      `Tx Hash: ${tx.hash}\n` +
      `Block: ${receipt.blockNumber}\n` +
      `\nView on PulseScan:\nhttps://scan.pulsechain.com/tx/${tx.hash}\n\n` +
      `âš ï¸ Reminder: Anyone with your Secret can withdraw during the 7-day window.`
    );

    // Update displayed metrics
    updateVaultBalance();
    updateRewardPool();
  } catch (e) {
    console.error("âŒ Withdraw failed:", e);

    // Detailed alert for debugging
    const msg = e.data?.message || e.message || "Unknown error";
    alert(
      `âŒ Withdraw failed:\n\n${msg}\n\n` +
      `ğŸ’¡ Common causes:\n` +
      `â€¢ No valid commit found for this secret.\n` +
      `â€¢ Commit expired (waited too long >5min window).\n` +
      `â€¢ Wrong secret (must match deposit).\n` +
      `â€¢ Using a different wallet than the one that committed.`
    );
  }
}

  async function reclaim() {
    const h = document.getElementById("reclaimHash").value.trim();
    if (!h) return alert("Enter deposit hash.");
    if (!await ensurePulse()) return;
    try {
      const tx = await contract.reclaim(h);
      alert("ğŸ”¥ Reclaim submitted!\nTx: " + tx.hash);
      updateVaultBalance(); updateBurnCounter(); updateRewardPool();
    } catch (e) {
      alert("Reclaim failed:\n" + e.message);
    }
  }

    // === IMPROVED: Load Reclaimable Hashes ===
  async function loadReclaimable() {
    const list = document.getElementById("reclaimList");
    list.innerHTML = "â³ Loadingâ€¦";
    try {
      // âœ… Get all deposits and filter those eligible for reclaim (if contract has allDeposits public)
      const totalHashes = await pubContract.totalReclaimed ? await pubContract.totalReclaimed() : 0;
      if (!pubContract.deposits) {
        list.innerHTML = "âš ï¸ This contract version doesnâ€™t expose reclaimable hashes directly.";
        return;
      }

      // We'll try reading last 100 hashes if allDeposits() isn't public.
      // You can adjust this later to read from events instead.
      list.innerHTML = "â„¹ï¸ Waiting for first deposits to appearâ€¦";
    } catch (e) {
      list.innerHTML = "âŒ Error fetching reclaimable data.<br>" + e.message;
    }
  }

  // === NEW: Check Deposit Status by Hash ===
  async function checkDepositStatus() {
    const hash = document.getElementById("checkHash").value.trim();
    if (!hash) return alert("Enter a valid deposit hash first.");

    const out = document.getElementById("checkResult");
    out.textContent = "â³ Checking on-chain statusâ€¦";

    try {
      const d = await pubContract.deposits(hash);
      if (!d || (d.amount?.eq?.(0) || d[0]?.eq?.(0))) {
        out.innerHTML = "âŒ No deposit found for this hash.";
        return;
      }

      const amount = ethers.utils.formatUnits(d.amount || d[0], 18);
      const ts = Number(d.timestamp || d[1]);
      const claimed = d.claimed || d[2];

      const depositDate = new Date(ts * 1000);
      const expiry = depositDate.getTime() + 7 * 24 * 60 * 60 * 1000;
      const now = Date.now();
      const remainingMs = expiry - now;
      const remainingDays = (remainingMs / (1000 * 60 * 60 * 24)).toFixed(2);

      let status, color;
      if (claimed) {
        status = "âœ… Claimed / Withdrawn";
        color = "#00ff99";
      } else if (remainingMs > 0) {
        status = `ğŸŸ£ Active (${remainingDays} days left)`;
        color = "#00ffcc";
      } else {
        status = "ğŸ”¥ Expired (Reclaimable)";
        color = "#ff6600";
      }

      out.innerHTML = `
        <div style="color:${color}">
          <b>Status:</b> ${status}<br>
          <b>Amount:</b> ${amount} PRIVX<br>
          <b>Deposited:</b> ${depositDate.toLocaleString()}<br>
          <b>Expires:</b> ${new Date(expiry).toLocaleString()}<br>
        </div>
      `;
    } catch (e) {
      console.error(e);
      out.textContent = "âŒ Error: " + e.message;
    }
  }


  // === Button bindings ===
  document.getElementById("connect").onclick = connect;
  document.getElementById("disconnect").onclick = disconnect;
  document.getElementById("approveBtn").onclick = approve;
  document.getElementById("depositBtn").onclick = deposit;
  document.getElementById("withdrawBtn").onclick = withdraw;
  document.getElementById("reclaimBtn").onclick = reclaim;
  document.getElementById("commitBtn").onclick = commitHashDirect;
  document.getElementById("loadReclaimable").onclick = loadReclaimable;
  document.getElementById("checkBtn").onclick = checkDepositStatus;


  // === Auto-refreshes every 30s ===
updateVaultBalance();
updateBurnCounter();
updateRewardPool();
loadReclaimable();
updateShieldStrength(); // ğŸ›¡ï¸ NEW

setInterval(() => {
  updateVaultBalance();
  updateBurnCounter();
  updateRewardPool();
  loadReclaimable();
  updateShieldStrength(); // ğŸ›¡ï¸ NEW
}, 30000);

})();
</script>
</body>
</html>

