<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrivX Hurricane â€“ Privacy That Pays</title>
    <link rel="icon" href="privx-shield.png" type="image/png">
    <meta name="description" content="The world's first fully on-chain, ownerless, immutable privacy protocol. Instant 2% Proof-of-Privacy rewards.">
    <meta property="og:title" content="PrivX Hurricane â€“ Privacy That Pays">
    <meta property="og:description" content="Anonymous PRIVX transfers + instant 2% rewards. ELITE Team6 â€“ November 7, 2025">
    <meta property="og:image" content="https://i.ibb.co/9y3vJ3q/privx-shield.png">
    <meta name="theme-color" content="#8A2BE2">
    <style>
        :root {
            --primary: #8A2BE2;
            --accent: #00ffea;
            --bg: #000;
            --card: rgba(138,43,226,0.15);
            --glow: rgba(138,43,226,0.6);
        }
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;overflow-x:hidden}
        canvas#matrix-bg{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
        .container{background:rgba(10,10,10,0.7);backdrop-filter:blur(20px);border-radius:24px;padding:40px 30px;max-width:620px;width:100%;border:1px solid var(--primary);box-shadow:0 0 80px var(--glow),inset 0 0 40px rgba(138,43,226,0.1);position:relative;z-index:10}
        h1{font-size:3.2em;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;color:transparent;margin-bottom:8px;text-shadow:0 0 30px var(--glow)}
        .subtitle{color:var(--accent);font-size:1.4em;margin-bottom:30px}
        .wallet-button{position:fixed;top:20px;right:20px;background:rgba(10,10,10,0.8);backdrop-filter:blur(10px);padding:12px 28px;border:2px solid var(--primary);border-radius:12px;color:#fff;font-weight:600;cursor:pointer;transition:all .3s;z-index:9999}
        .wallet-button:hover{border-color:var(--accent);box-shadow:0 0 30px var(--glow)}
        .wallet-button.connected{color:var(--accent);border-color:var(--accent);box-shadow:0 0 30px var(--glow)}
        .tabs{display:flex;gap:12px;margin-bottom:30px}
        .tab{flex:1;padding:14px;border:2px solid rgba(255,255,255,0.1);border-radius:12px;background:rgba(20,20,20,0.6);cursor:pointer;transition:all .3s;text-align:center;font-weight:600}
        .tab:hover{border-color:var(--primary)}
        .tab.active{background:var(--primary);color:#fff;border-color:var(--primary);box-shadow:0 0 30px var(--glow)}
        .denomination-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:30px 0}
        .denomination-card{background:var(--card);border:2px solid transparent;border-radius:16px;padding:24px;cursor:pointer;transition:all .4s;text-align:center}
        .denomination-card:hover{border-color:var(--primary);transform:translateY(-6px);box-shadow:0 12px 40px rgba(138,43,226,0.4)}
        .denomination-card.selected{border:3px solid var(--primary);background:rgba(138,43,226,0.3);box-shadow:0 0 50px var(--glow);transform:scale(1.04)}
        .denomination-amount{font-size:26px;font-weight:900;display:flex;align-items:center;justify-content:center;gap:12px;color:#fff}
        .denomination-amount img{height:36px;width:36px;border-radius:50%;box-shadow:0 0 20px var(--glow)}
        .denomination-label{margin-top:8px;color:#aaa;font-size:13px}
        .button{width:100%;padding:18px;background:var(--primary);color:#fff;border:none;border-radius:14px;font-size:18px;font-weight:700;cursor:pointer;margin-top:20px;transition:all .3s;box-shadow:0 0 30px var(--glow)}
        .button:hover{background:var(--accent);color:#000;transform:translateY(-3px)}
        .button:disabled{background:#333;color:#666;cursor:not-allowed}
        .note-display{background:#111;border:2px solid var(--primary);padding:20px;border-radius:14px;margin-top:25px;font-family:monospace;color:var(--accent);box-shadow:0 0 30px var(--glow)}
        .stats-list{background:rgba(20,20,20,0.6);border-radius:14px;padding:20px;margin-top:30px;border:1px solid rgba(138,43,226,0.3)}
        .stat-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
        .stat-row:last-child{border:none}
        .stat-denomination{font-weight:700;color:#fff}
        .stat-balance{color:var(--accent);font-weight:700}
        .vault-display{margin-top:30px;padding:20px;background:rgba(138,43,226,0.2);border-radius:14px;text-align:center;border:1px solid var(--primary)}
        .vault-display span{color:var(--accent);font-size:1.4em;font-weight:900}
    </style>
</head>
<body>
    <canvas id="matrix-bg"></canvas>

    <div id="walletButton" class="wallet-button" onclick="toggleWallet()">
        <span id="walletButtonText">Connect Wallet</span>
    </div>

    <div class="container">
        <h1>PrivX Hurricane Shield</h1>
        <p class="subtitle">Anonymous PRIVX + Instant 2% Proof-of-Privacy Rewards</p>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('deposit')">Deposit</div>
            <div class="tab" onclick="switchTab('withdraw')">Withdraw</div>
        </div>

        <div id="depositTab">
            <div class="denomination-grid">
                <div class="denomination-card" onclick="selectDenomination('100')">
                    <div class="denomination-amount">100 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
                    <div class="denomination-label">Instant 2% reward</div>
                </div>
                <div class="denomination-card" onclick="selectDenomination('1,000')">
                    <div class="denomination-amount">1,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
                    <div class="denomination-label">Instant 2% reward</div>
                </div>
                <div class="denomination-card" onclick="selectDenomination('10,000')">
                    <div class="denomination-amount">10,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
                    <div class="denomination-label">Instant 2% reward</div>
                </div>
                <div class="denomination-card" onclick="selectDenomination('100,000')">
                    <div class="denomination-amount">100,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
                    <div class="denomination-label">Instant 2% reward</div>
                </div>
            </div>

            <button class="button" id="depositBtn" disabled>Connect Wallet First</button>

            <div id="depositNote" class="note-display hidden">
                <strong>YOUR PRIVATE NOTE (SAVE THIS!)</strong><br><br>
                <span id="noteText"></span><br><br>
                <button class="button" onclick="copyNote()" style="padding:12px 24px;font-size:15px">Copy Note</button>
            </div>
        </div>

        <div id="withdrawTab" class="hidden">
            <input type="text" id="withdrawNote" placeholder="Paste your private note here" style="width:100%;padding:16px;margin:15px 0;border-radius:12px;border:1px solid #444;background:#111;color:#fff;font-family:monospace">
            <input type="text" id="recipientAddress" placeholder="Recipient address (optional â€“ defaults to your wallet)" style="width:100%;padding:16px;margin:15px 0;border-radius:12px;border:1px solid #444;background:#111;color:#fff">
            <button class="button" onclick="withdraw()">Withdraw + Claim 2% Reward</button>
        </div>

        <div class="vault-display">
            <div>V14 Proof-of-Privacy Vault</div>
            <span id="vaultBalance">Loading...</span> PRIVX Available<br>
            <small>Rewards paid instantly on every shielded withdrawal</small>
        </div>

        <div class="stats-list" id="statsContainer">
            <!-- Stats populated by fast-stats.js -->
        </div>
    </div>

           <!-- Universal Wallet Connector + PrivX Engine -->
    <script src="web3.min.js"></script>
    <script src="config-all-denominations.js"></script>
    <script src="tornado-api.js"></script>
    <script src="withdrawal-complete.js"></script>
    <script src="deposit-tracker.js"></script>
    <script src="fast-stats.js"></script>

    <script>
        // Universal Wallet Connector â€“ Works with MetaMask, Rabby, Coinbase, WalletConnect, etc.
        let web3;
        let userAccount;
        let selectedDenomination;

        // Detect ANY ethereum provider
        function detectWallets() {
            if (typeof window.ethereum !== 'undefined') {
                // MetaMask, Rabby, Coinbase â€“ all use window.ethereum
                web3 = new Web3(window.ethereum);
                return true;
            } else if (typeof window.web3 !== 'undefined') {
                // Legacy Mist/BitPay
                web3 = new Web3(window.web3.currentProvider);
                return true;
            } else {
                return false;
            }
        }

        // Universal connect function
        window.toggleWallet = async function() {
            const button = document.getElementById('walletButton');
            const text = document.getElementById('walletButtonText');

            if (!detectWallets()) {
                alert('No wallet detected! Install MetaMask or Rabby.');
                return;
            }

            try {
                // Request accounts â€“ works with all EIP-1193 providers (Rabby, MetaMask, etc.)
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];

                // Switch to PulseChain mainnet (chainId 369)
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x171' }] // 369 in hex
                    });
                } catch (switchError) {
                    // If chain not added, add it
                    if (switchError.code === 4902) {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x171',
                                chainName: 'PulseChain',
                                rpcUrls: ['https://rpc.pulsechain.com'],
                                nativeCurrency: { name: 'Pulse', symbol: 'PLS', decimals: 18 },
                                blockExplorerUrls: ['https://scan.pulsechain.com']
                            }]
                        });
                    }
                }

                // Update UI
                button.classList.add('connected');
                text.textContent = userAccount.slice(0,6) + '...' + userAccount.slice(-4);
                button.onclick = () => { /* Disconnect logic if needed */ };

                // Load balance and update button
                loadBalance();
                if (typeof updateDepositButton === 'function') updateDepositButton();

                console.log('Connected:', userAccount);
            } catch (error) {
                console.error('Connection failed:', error);
                alert('Connection rejected. Try again?');
            }
        };

        // Load PRIVX balance
        async function loadBalance() {
            if (!userAccount || !web3) return;
            const privxABI = [{'constant':true,'inputs':[{'name':'_owner','type':'address'}],'name':'balanceOf','outputs':[{'name':'balance','type':'uint256'}],'type':'function'}];
            const privxContract = new web3.eth.Contract(privxABI, window.PRIVX_TOKEN);
            try {
                const balance = await privxContract.methods.balanceOf(userAccount).call();
                const formatted = web3.utils.fromWei(balance, 'ether');
                // Update balance display if exists
                const balanceEl = document.getElementById('balanceDisplay');
                if (balanceEl) balanceEl.textContent = `Balance: ${formatted} PRIVX`;
            } catch (e) {
                console.log('Balance load failed:', e);
            }
        }

        // Update deposit button for any wallet
        window.updateDepositButton = function() {
            const btn = document.getElementById('depositBtn');
            if (!userAccount) {
                btn.textContent = 'Connect Wallet First';
                btn.disabled = true;
            } else if (!selectedDenomination) {
                btn.textContent = 'Select Amount';
                btn.disabled = true;
            } else {
                btn.textContent = `Deposit ${selectedDenomination} PRIVX`;
                btn.disabled = false;
            }
        };

        // Final PrivX Selection Logic
        window.selectDenomination = function(denom) {
            selectedDenomination = denom.replace(/,/g, '');
            window.selectedDenomination = denom;
            document.querySelectorAll('.denomination-card').forEach(c => {
                c.classList.remove('selected');
                if (c.textContent.includes(denom)) c.classList.add('selected');
            });
            updateDepositButton();
        };

        // Copy note function
        window.copyNote = function() {
            const note = document.getElementById('noteText').textContent;
            navigator.clipboard.writeText(note).then(() => {
                alert('Note copied! Keep it safe.');
            });
        };

        // Tab switching
        window.switchTab = function(tab) {
            document.getElementById('depositTab').classList.toggle('hidden', tab !== 'deposit');
            document.getElementById('withdrawTab').classList.toggle('hidden', tab !== 'withdraw');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        };

        // Load on startup
        window.addEventListener('load', () => {
            if (detectWallets()) {
                // Auto-connect if already authorized
                window.ethereum.request({ method: 'eth_accounts' }).then(accounts => {
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        toggleWallet(); // Reuse for UI update
                    }
                });
            }
            loadBalance();
            updateDepositButton();
        });

        // Listen for account changes (Rabby/MetaMask)
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', accounts => {
                if (accounts.length === 0) {
                    // Disconnected
                    userAccount = null;
                    document.getElementById('walletButtonText').textContent = 'Connect Wallet';
                    document.getElementById('walletButton').classList.remove('connected');
                    updateDepositButton();
                } else {
                    userAccount = accounts[0];
                    loadBalance();
                    updateDepositButton();
                }
            });

            window.ethereum.on('chainChanged', () => location.reload());
        }
    </script>

    <!-- Load app-complete.js LAST â€“ it now uses our universal web3 -->
    <script src="app-complete.js"></script>

    <!-- PrivX Matrix Rain â€“ Purple Edition -->
    <script>
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');
        canvas.width = innerWidth; canvas.height = innerHeight;
        addEventListener('resize', () => { canvas.width = innerWidth; canvas.height = innerHeight; });
        const chars = '01PRIVXHURRICANEðŸŒ€âš¡ðŸ”’';
        const drops = [];
        for(let i = 0; i < canvas.width/14; i++) drops[i] = 1;
        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = '#8A2BE2'; ctx.font = '14px monospace';
            drops.forEach((y,i) => {
                const text = chars[Math.floor(Math.random()*chars.length)];
                ctx.fillText(text, i*14, y*14);
                if(y*14 > canvas.height && Math.random()>0.975) drops[i] = 0;
                drops[i]++;
            });
        }
        setInterval(draw, 33);
    </script>
</body>
</html>
