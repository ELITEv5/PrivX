<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>PrivX Hash Generator (Offline)</title>
<script src="./ethers.umd.min.js"></script>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #0a0a0a;
    color: #eaeaea;
    text-align: center;
    padding: 2rem;
    max-width: 750px;
    margin: 0 auto;
  }
  h1 { color: #8b5cf6; }
  button {
    padding: 0.7rem 1.2rem;
    background: #5c00ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    margin: 0.3rem;
  }
  button:disabled { background: #333; cursor: not-allowed; }
  pre {
    background: #111;
    color: #00ff7f;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 0.9rem;
    text-align: left;
    white-space: pre-wrap;
    word-break: break-all;
  }
  small { color: #aaa; display: block; margin-top: 1rem; }
  .instructions {
    background: #161616;
    padding: 1rem;
    border-radius: 10px;
    text-align: left;
    margin-bottom: 1.5rem;
    line-height: 1.4em;
  }
  #unsavedWarning {
    display: none;
    background: #ffcc00;
    color: #000;
    padding: 0.8rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-weight: bold;
  }
</style>
</head>

<body>
  <h1>üîê PrivX Hash Generator</h1>
  <p>This tool runs 100% locally in your browser. No data ever leaves your device.</p>

  <div class="instructions">
    <h3>üß≠ How to Use</h3>
    <ol>
      <li>Click <b>Generate Secret & Hash</b> to create your unique deposit pair.</li>
      <li>The <b>Hash</b> goes into the <b>PrivX deposit field</b>.</li>
      <li>The <b>Secret</b> lets you withdraw those funds within 7 days.</li>
      <li>After 7 days, anyone can reclaim using the deposit Hash (95 % burn / 5 % reward).</li>
      <li>To send privately, share only the Secret with a recipient; they can withdraw to up to 3 wallets.</li>
    </ol>
    <p><b>‚ö†Ô∏è Anyone with your Secret can withdraw within 7 days.</b> After expiration, the Secret no longer matters.</p>
  </div>

  <div id="unsavedWarning">‚ö†Ô∏è You have an unsaved Secret! Copy or save it before generating a new one.</div>

  <button id="generate">Generate Secret & Hash</button>
  <button id="copySecret" disabled>Copy Secret ‚ö†Ô∏è</button>
  <button id="copyHash" disabled>Copy Hash</button>
  <button id="saveTxt" disabled>Save .txt</button>

  <pre id="output">Click ‚ÄúGenerate‚Äù to create your secret and hash.</pre>

  <small>
    üí° The <b>Secret</b> unlocks funds for 7 days.  
    The <b>Hash</b> is used for deposit or reclaim.  
    Works fully offline ‚Äî you can verify by disconnecting your internet.
  </small>

<script>
  let secret = "";
  let hash = "";
  const warnBanner = document.getElementById("unsavedWarning");

  // Generate with safety confirmation
  document.getElementById("generate").onclick = () => {
    if (secret && hash) {
      const confirmNew = confirm(
        "‚ö†Ô∏è You already generated a Secret and Hash.\n\n" +
        "If you continue, the previous Secret will be lost forever unless saved.\n\n" +
        "Continue and overwrite?"
      );
      if (!confirmNew) return;
    }

    const bytes = crypto.getRandomValues(new Uint8Array(32));
    secret = Array.from(bytes).map(b => b.toString(16).padStart(2, "0")).join("");
    const abi = new ethers.AbiCoder();
    const encoded = abi.encode(["string"], [secret]);
    hash = ethers.keccak256(encoded);

    document.getElementById("output").textContent =
      `Secret (for withdrawal within 7 days):\n${secret}\n\n` +
      `Hash (for deposit):\n${hash}\n\n` +
      `‚ö†Ô∏è Store your Secret securely. Share it only with intended recipients within the 7-day window.`;

    document.getElementById("copySecret").disabled = false;
    document.getElementById("copyHash").disabled = false;
    document.getElementById("saveTxt").disabled = false;
    warnBanner.style.display = "block";
  };

  // Copy Secret
  document.getElementById("copySecret").onclick = async () => {
    if (!secret) return;
    const ok = confirm(
      "‚ö†Ô∏è This is your private withdrawal key.\n\n" +
      "Anyone with it can claim your deposit within 7 days.\n\n" +
      "Copy to clipboard?"
    );
    if (!ok) return;
    await navigator.clipboard.writeText(secret);
    alert("Secret copied to clipboard ‚úÖ (store securely)");
    warnBanner.style.display = "none";
  };

  // Copy Hash
  document.getElementById("copyHash").onclick = async () => {
    if (!hash) return;
    await navigator.clipboard.writeText(hash);
    alert("Hash copied to clipboard ‚úÖ (use for deposit)");
  };

  // Save as text file
  document.getElementById("saveTxt").onclick = () => {
    if (!secret || !hash) return;
    const blob = new Blob(
      [
        "PrivX Secret + Hash\n\n",
        "Secret (valid for 7-day withdrawal):\n", secret, "\n\n",
        "Hash (deposit reference):\n", hash, "\n\n",
        "‚ö†Ô∏è Keep this file private. Anyone with the Secret can withdraw within 7 days.\n",
        "After 7 days, funds become reclaimable (95 % burn, 5 % reward).\n"
      ],
      { type: "text/plain" }
    );
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "privx-secret-hash.txt";
    link.click();
    warnBanner.style.display = "none";
  };
</script>
</body>
</html>
