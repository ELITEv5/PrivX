<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PrivX Hurricane â€“ Privacy That Pays</title>
  <link rel="icon" href="privx-shield.png" type="image/png">
  <meta property="og:image" content="https://github.com/ELITEv5/PrivX/Hurricane/privx-shield.png">
  <meta property="og:type" content="website">
  <meta name="robots" content="index,follow">
  <meta name="description" content="The world's first fully on-chain, ownerless, immutable privacy protocol. Instant 2% Proof-of-Privacy rewards.">
  <meta property="og:title" content="PrivX Hurricane â€“ Privacy That Pays">
  <meta property="og:description" content="Anonymous PRIVX transfers + instant 1-2% rewards. ELITE Team6 â€“ November 7, 2025">
  <meta name="theme-color" content="#8A2BE2">
  <style>
    :root {
      --primary: #8A2BE2;
      --accent: #00ffea;
      --bg: #000;
      --card: rgba(138,43,226,0.15);
      --glow: rgba(138,43,226,0.6);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;overflow-x:hidden}
    canvas#matrix-bg{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
    .container{background:rgba(10,10,10,0.7);backdrop-filter:blur(20px);border-radius:24px;padding:40px 30px;max-width:620px;width:100%;border:1px solid var(--primary);box-shadow:0 0 80px var(--glow),inset 0 0 40px rgba(138,43,226,0.1);position:relative;z-index:10}
    .subtitle{color:var(--accent);font-size:1.4em;margin-bottom:30px}
    .wallet-button{position:fixed;top:20px;right:20px;background:rgba(10,10,10,0.8);backdrop-filter:blur(10px);padding:12px 28px;border:2px solid var(--primary);border-radius:12px;color:#fff;font-weight:600;cursor:pointer;transition:all .3s;z-index:9999}
    .wallet-button:hover{border-color:var(--accent);box-shadow:0 0 30px var(--glow)}
    .wallet-button.connected{color:var(--accent);border-color:var(--accent);box-shadow:0 0 30px var(--glow)}
    .tabs{display:flex;gap:12px;margin-bottom:30px}
    .tab{flex:1;padding:14px;border:2px solid rgba(255,255,255,0.1);border-radius:12px;background:rgba(20,20,20,0.6);cursor:pointer;transition:all .3s;text-align:center;font-weight:600}
    .tab:hover{border-color:var(--primary)}
    .tab.active{background:var(--primary);color:#fff;border-color:var(--primary);box-shadow:0 0 30px var(--glow)}
    .denomination-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:30px 0}
    .denomination-card{background:var(--card);border:2px solid transparent;border-radius:16px;padding:24px;cursor:pointer;transition:all .4s;text-align:center}
    .denomination-card:hover{border-color:var(--primary);transform:translateY(-6px);box-shadow:0 12px 40px rgba(138,43,226,0.4)}
    .denomination-card.selected{border:3px solid var(--primary);background:rgba(138,43,226,0.3);box-shadow:0 0 50px var(--glow);transform:scale(1.04)}
    .denomination-amount{font-size:26px;font-weight:900;display:flex;align-items:center;justify-content:center;gap:12px;color:#fff}
    .denomination-amount img{height:36px;width:36px;border-radius:50%;box-shadow:0 0 20px var(--glow)}
    .denomination-label{margin-top:8px;color:#aaa;font-size:13px}
    .button{width:100%;padding:18px;background:var(--primary);color:#fff;border:none;border-radius:14px;font-size:18px;font-weight:700;cursor:pointer;margin-top:20px;transition:all .3s;box-shadow:0 0 30px var(--glow)}
    .button:hover{background:var(--accent);color:#000;transform:translateY(-3px)}
    .button:disabled{background:#333;color:#666;cursor:not-allowed}
    .note-display{background:#111;border:2px solid var(--primary);padding:20px;border-radius:14px;margin-top:25px;font-family:monospace;color:var(--accent);box-shadow:0 0 30px var(--glow)}
    .vault-display{margin-top:30px;padding:20px;background:rgba(138,43,226,0.2);border-radius:14px;text-align:center;border:1px solid var(--primary)}
    .vault-display span{color:var(--accent);font-size:1.4em;font-weight:900}
    .hidden { display: none !important; }
    .logo-header { text-align: center; margin-bottom: 30px; }
    .privx-logo { max-width: 340px; width: 100%; height: auto; margin: 0 auto 12px auto; display: block; filter: drop-shadow(0 0 25px var(--glow)); transition: transform 0.3s ease, filter 0.3s ease; }
    .privx-logo:hover { transform: scale(1.07); filter: drop-shadow(0 0 40px var(--accent)); }
    @media (max-width: 768px) { .privx-logo { max-width: 260px; } }
    @media (max-width: 480px) { .privx-logo { max-width: 200px; } }
    @media (max-width: 768px) {
      .subtitle { font-size:1.1em; text-align:center; }
      .container { max-width:95%; padding:24px 18px; }
      .wallet-button { top:10px; right:10px; padding:10px 16px; font-size:14px; }
      .denomination-grid { grid-template-columns:1fr; }
      .note-display { font-size:14px; word-break:break-all; }
    }
  </style>
</head>
<body>
  <canvas id="matrix-bg"></canvas>
  <div id="walletButton" class="wallet-button" onclick="toggleWallet()">
    <span id="walletButtonText">Connect Wallet</span>
  </div>
  <div class="container">
    <div class="logo-header">
      <img src="privx_logo.png" alt="PrivX Hurricane" class="privx-logo">
      <p class="subtitle">Hurricane Shield + Instant 1-2% Proof-of-Privacy Rewards</p>
    </div>
    <div class="tabs">
      <div class="tab active" onclick="switchTab('deposit')">Deposit</div>
      <div class="tab" onclick="switchTab('withdraw')">Withdraw</div>
    </div>
    <div id="depositTab">
      <div class="denomination-grid">
        <div class="denomination-card" onclick="selectDenomination('100')">
          <div class="denomination-amount">100 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
          <div class="denomination-label">Instant 2% reward</div>
        </div>
        <div class="denomination-card" onclick="selectDenomination('1000')">
          <div class="denomination-amount">1,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
          <div class="denomination-label">Instant 2% reward</div>
        </div>
        <div class="denomination-card" onclick="selectDenomination('10000')">
          <div class="denomination-amount">10,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
          <div class="denomination-label">Instant 2% reward</div>
        </div>
        <div class="denomination-card" onclick="selectDenomination('100000')">
          <div class="denomination-amount">100,000 PRIVX <img src="privx-shield.png" alt="PrivX"></div>
          <div class="denomination-label">Instant 2% reward</div>
        </div>
      </div>
      <button class="button" id="depositBtn" disabled>Select Denomination</button>
      <div id="depositNote" class="note-display hidden">
        <strong>YOUR PRIVATE NOTE â€“ SAVE THIS SECURELY!</strong><br><br>
        <span id="noteText"></span><br><br>
        <button class="button" onclick="copyNote()" style="padding:12px 24px;font-size:15px;width:auto">Copy Note</button>
      </div>
    </div>
    <div id="withdrawTab" class="hidden">
      <input type="text" id="withdrawNote" placeholder="Paste your private note here" style="width:100%;padding:16px;margin:15px 0;border-radius:12px;border:1px solid #444;background:#111;color:#fff;font-family:monospace">
      <input type="text" id="recipientAddress" placeholder="Recipient address (optional â€“ defaults to connected wallet)" style="width:100%;padding:16px;margin:15px 0;border-radius:12px;border:1px solid #444;background:#111;color:#fff">
      <button class="button" id="withdrawBtn">Generate Proof + Withdraw</button>
    </div>
    <div class="vault-display">
      <div>Proof-of-Privacy Mining Vault</div>
      <span id="vaultBalance">Loading...</span> PRIVX Available
    </div>
    <div class="vault-display">
      <div>ðŸ”¥ Total PRIVX Burned</div>
      <span id="burnedBalance">Loading...</span> PRIVX
    </div>
  </div>

  <!-- âœ… Load Web3 & SnarkJS -->
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/snarkjs@0.7.5/dist/snarkjs.min.js"></script>

<script>
let web3, userAccount, selectedDenomination;

// =============================
// ðŸ§  Tab Switching Logic
// =============================
function switchTab(tab) {
  document.getElementById('depositTab').classList.add('hidden');
  document.getElementById('withdrawTab').classList.add('hidden');
  document.getElementById(tab + 'Tab').classList.remove('hidden');
  document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');

  if (typeof updateFastStats === 'function') updateFastStats();
  if (typeof updateBurnedBalance === 'function') updateBurnedBalance();
}
window.addEventListener('load', () => switchTab('deposit'));

// =============================
// ðŸ”® Poseidon Hasher (Hasher.sol compatible)
// =============================
const P = 21888242871839275222246405745257275088548364400416034343698204186575808495617n;
const C = [
  12861791851186454756856465657750459816989389089376497637901611881939633773556n,
  5519671076407899149475471873582650243950107592374834593479994102631768852387n,
  10832496908481223032496354855685040477446072176891917826424127680329380157411n,
  197023341468610140031081920968023783964819417505440696127650404864701462882n,
  182251860366398770052311923749666265525174614955508549662173528391496234720n,
  133961901813997148524200689039311302035210029358159615165091333675391005n,
  21526503533429280966392593094949932105722060737862572179582474350057866930688n,
  22616005108334998208888373407539051456988600368523n,
  138521903175307636434294058242398758941602410109806n
];
const M = 91125930183199385026155961874833132762587307477754274831086764195748117360n;
function pow5(x) { const x2 = (x * x) % P; const x4 = (x2 * x2) % P; return (x4 * x) % P; }
async function poseidonT3(a, b) {
  let x = BigInt(a) % P, y = BigInt(b) % P;
  for (let i = 0; i < 8; i++) { x = (x + C[i] + y) % P; y = (y + C[i] + x) % P; x = pow5(x); y = pow5(y); }
  for (let i = 0; i < 56; i++) { x = (x + C[4]) % P; x = pow5(x); x = (x + M * y % P) % P; }
  for (let i = 5; i < 9; i++) { x = (x + C[i] + y) % P; y = (y + C[i] + x) % P; x = pow5(x); y = pow5(y); }
  return x;
}

// =============================
// ðŸ’° Deposit Logic
// =============================
const PRIVX_TOKEN = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
const SHIELD_CONTRACTS = {
  "100": "0x1746f6fe7447A13B7554fAb9FA0b77A8a5A61821",
  "1000": "0x0F15B28f1B9C9b3c4B7b9d7864ef79BeEBCb37b6",
  "10000": "0x8c17b741695Cb4B7c81F8Bfc20203B47dcd8d285",
  "100000": "0x4b393d5Bef35E225074Ed1f247D147F8c9e904F4"
};
const DENOM_AMOUNTS = {
  "100": "100000000000000000000",
  "1000": "1000000000000000000000",
  "10000": "10000000000000000000000",
  "100000": "100000000000000000000000"
};
const ERC20_ABI = [
  { "inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  { "inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}
];
const SHIELD_ABI = [{ "inputs":[{"internalType":"bytes32","name":"commitment","type":"bytes32"}],"name":"deposit","outputs":[],"stateMutability":"nonpayable","type":"function" }];

async function deposit() {
  if (!userAccount || !selectedDenomination) return alert("âš ï¸ Connect wallet & select amount");
  const btn = document.getElementById('depositBtn');
  btn.disabled = true; btn.textContent = "Generating Note...";

  try {
    const nullifier = crypto.getRandomValues(new Uint8Array(31));
    const secret = crypto.getRandomValues(new Uint8Array(31));
    const nullifierBI = BigInt("0x" + [...nullifier].map(b => b.toString(16).padStart(2,'0')).join(''));
    const secretBI = BigInt("0x" + [...secret].map(b => b.toString(16).padStart(2,'0')).join(''));
    const commitmentBI = await poseidonT3(nullifierBI, secretBI);
    const commitment = "0x" + commitmentBI.toString(16).padStart(64, '0');
    const note = `privx-hurricane-${selectedDenomination}-${[...nullifier].map(b=>b.toString(16).padStart(2,'0')).join('')}-${[...secret].map(b=>b.toString(16).padStart(2,'0')).join('')}`;

    document.getElementById('noteText').textContent = note;
    document.getElementById('depositNote').classList.remove('hidden');

    const amount = DENOM_AMOUNTS[selectedDenomination];
    const shieldAddr = SHIELD_CONTRACTS[selectedDenomination];
    const privx = new web3.eth.Contract(ERC20_ABI, PRIVX_TOKEN);
    const shield = new web3.eth.Contract(SHIELD_ABI, shieldAddr);

    const allowance = await privx.methods.allowance(userAccount, shieldAddr).call();
    if (BigInt(allowance) < BigInt(amount)) {
      btn.textContent = "Approving PRIVX...";
      await privx.methods.approve(shieldAddr, amount).send({ from: userAccount });
    }

    btn.textContent = "Depositing...";
    const tx = await shield.methods.deposit(commitment).send({ from: userAccount });
    alert(`âœ… DEPOSIT SUCCESS!\nTX: ${tx.transactionHash}\n\nSAVE YOUR NOTE!`);
  } catch (err) {
    console.error(err);
    alert("âŒ Deposit failed: " + (err.message || "Check MetaMask"));
  } finally {
    btn.disabled = false;
    btn.textContent = `Shield ${selectedDenomination} PRIVX`;
  }
}

// =============================
// ðŸ¦Š Wallet Connect
// =============================
window.toggleWallet = async function() {
  if (!window.ethereum) return alert("Install MetaMask");
  try {
    await window.ethereum.request({ method: "eth_requestAccounts" });
    try {
      await window.ethereum.request({ method: "wallet_switchEthereumChain", params: [{ chainId: "0x171" }] });
    } catch (e) {
      if (e.code === 4902) {
        await window.ethereum.request({
          method: "wallet_addEthereumChain",
          params: [{ chainId: "0x171", chainName: "PulseChain", rpcUrls: ["https://rpc.pulsechain.com"], nativeCurrency: { name: "PLS", symbol: "PLS", decimals: 18 }, blockExplorerUrls: ["https://scan.pulsechain.com"] }]
        });
      }
    }
    web3 = new Web3(window.ethereum);
    const accounts = await web3.eth.getAccounts();
    userAccount = accounts[0];
    document.getElementById("walletButtonText").textContent = `${userAccount.slice(0,6)}...${userAccount.slice(-4)}`;
    document.getElementById("walletButton").classList.add("connected");
    updateDepositButton();
    if (typeof updateBurnedBalance === "function") updateBurnedBalance();
    console.log("âœ… Wallet Connected:", userAccount);
  } catch (err) { console.error("Wallet connect error:", err); }
};

// =============================
// ðŸ’³ Denomination Selector
// =============================
window.selectDenomination = function(denom) {
  selectedDenomination = denom;
  document.querySelectorAll('.denomination-card').forEach(c => c.classList.remove('selected'));
  event.target.closest('.denomination-card').classList.add('selected');
  updateDepositButton();
};

function updateDepositButton() {
  const btn = document.getElementById('depositBtn');
  if (!userAccount) { btn.textContent = "Connect Wallet"; btn.disabled = false; btn.onclick = () => toggleWallet(); }
  else if (!selectedDenomination) { btn.textContent = "Select Denomination"; btn.disabled = true; }
  else { btn.textContent = `Shield ${selectedDenomination} PRIVX`; btn.disabled = false; btn.onclick = () => deposit(); }
}

// =============================
// ðŸ“‹ Copy Note Helper
// =============================
function copyNote() {
  const noteEl = document.getElementById('noteText');
  if (!noteEl) return;
  navigator.clipboard.writeText(noteEl.textContent).then(() => alert("ðŸ§¾ Note copied to clipboard!"));
}
</script>

<!-- ðŸŒ€ Matrix Rain Background -->
<script>
const canvas = document.getElementById('matrix-bg');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth; canvas.height = innerHeight;
let fontSize = innerWidth < 600 ? 10 : 14;
const chars = '01PRIVXHURRICANE';
let columns = Math.floor(canvas.width / fontSize);
let drops = Array(columns).fill(1);

function draw() {
  ctx.fillStyle = 'rgba(0,0,0,0.05)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#8A2BE2';
  ctx.font = fontSize + 'px monospace';
  drops.forEach((y,i) => {
    const text = chars[Math.floor(Math.random()*chars.length)];
    ctx.fillText(text, i*fontSize, y*fontSize);
    if(y*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
    drops[i]++;
  });
}
requestAnimationFrame(function loop(){ draw(); requestAnimationFrame(loop); });
</script>

<!-- ðŸ”¥ PrivX Burn Tracker â€” Works With or Without Wallet -->
<script>
(async () => {
  const PRIVX_TOKEN = "0x34310B5d3a8d1e5f8e4A40dcf38E48d90170E986";
  const BURN_ADDRESSES = [
    "0x000000000000000000000000000000000000dEaD",
    "0x0000000000000000000000000000000000000369"
  ];

  const PRIVX_ABI = [
    { "name": "totalSupply", "type": "function", "inputs": [], "outputs": [{ "type": "uint256" }], "stateMutability": "view" },
    { "name": "decimals", "type": "function", "inputs": [], "outputs": [{ "type": "uint8" }], "stateMutability": "view" },
    { "name": "balanceOf", "type": "function", "inputs": [{ "name": "account", "type": "address" }], "outputs": [{ "type": "uint256" }], "stateMutability": "view" }
  ];

  // âœ… Get provider dynamically
  function getWeb3Provider() {
    if (window.ethereum) {
      console.log("ðŸ”— Using wallet provider (MetaMask / PulseChain)");
      return new Web3(window.ethereum);
    }
    console.log("ðŸŒ No wallet found â€” using PulseChain RPC fallback");
    return new Web3(new Web3.providers.HttpProvider("https://rpc.pulsechain.com"));
  }

  async function updateBurnedBalance() {
    const el = document.getElementById("burnedBalance");
    if (!el) return;
    el.textContent = "Loading...";

    try {
      const web3 = getWeb3Provider();
      const token = new web3.eth.Contract(PRIVX_ABI, PRIVX_TOKEN);

      const [decimals, totalSupplyRaw, ...burnBalances] = await Promise.all([
        token.methods.decimals().call(),
        token.methods.totalSupply().call(),
        ...BURN_ADDRESSES.map(addr => token.methods.balanceOf(addr).call())
      ]);

      let totalBurned = 0n;
      for (const b of burnBalances) totalBurned += BigInt(b);

      const divisor = 10n ** BigInt(decimals);
      const burned = totalBurned / divisor;
      const supply = BigInt(totalSupplyRaw) / divisor;
      const percent = supply > 0n ? (Number(burned) / Number(supply)) * 100 : 0;

      // ðŸ§© Optional: show individual burn address balances for transparency
      const details = BURN_ADDRESSES.map((addr, i) => {
        const short = addr.slice(0, 8) + "..." + addr.slice(-4);
        const b = Number(BigInt(burnBalances[i]) / divisor).toLocaleString();
        return `${short}: ${b}`;
      }).join(" | ");

      el.innerHTML = `
        <strong>${Number(burned).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong> PRIVX
        <span style="color:#00ffea;">(${percent.toFixed(2)}% burned)</span><br>
        <small>${details}</small>
      `;

      console.log("ðŸ”¥ PRIVX Burn Debug â†’", {
        decimals,
        totalSupply: totalSupplyRaw,
        burnBalances,
        totalBurned: burned.toString(),
        percent
      });

    } catch (err) {
      console.error("ðŸ”¥ Error loading burn balance:", err);
      el.textContent = "Error";
    }
  }

  // Auto-refresh every 30s
  window.addEventListener("load", () => {
    updateBurnedBalance();
    setInterval(updateBurnedBalance, 30000);
  });
})();
</script>
</body>
</html>
